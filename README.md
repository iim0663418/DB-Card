# DB-Card - NFC æ•¸ä½åç‰‡ç³»çµ± v4.1.0

åŸºæ–¼ã€Œéš±ç§å„ªå…ˆã€èˆ‡ã€Œå®‰å…¨è‡³ä¸Šã€ç†å¿µçš„ä¼æ¥­ç´š NFC æ•¸ä½åç‰‡ç³»çµ±

## v4.1.0 æ›´æ–°å…§å®¹ (2026-01-20)

### æ–°å¢åŠŸèƒ½ ğŸ‰
- **å¤šå±¤é˜²è­·æ©Ÿåˆ¶**ï¼šNFC Tap API å¯¦ä½œä¸‰å±¤é˜²è­·
  - Layer 1: 60 ç§’å»é‡æ©Ÿåˆ¶ï¼ˆé˜²æ­¢é‡è¤‡è«‹æ±‚ï¼‰
  - Layer 2: é›™ç¶­åº¦é€Ÿç‡é™åˆ¶ï¼ˆCard UUID + IPï¼‰
  - Layer 3: ä½µç™¼è®€å–é™åˆ¶ï¼ˆä¿ç•™ç¾æœ‰æ©Ÿåˆ¶ï¼‰
- **æ™ºæ…§å»é‡**ï¼š60 ç§’å…§é‡è¤‡è§¸ç¢°è¿”å›ç›¸åŒ sessionï¼Œæ¸›å°‘è³‡æºæ¶ˆè€—
- **é€Ÿç‡é™åˆ¶**ï¼š10 æ¬¡/åˆ†é˜ã€50 æ¬¡/å°æ™‚ï¼ˆé˜²æ­¢çˆ¬èŸ²æ¿«ç”¨ï¼‰
- **IP å„ªå…ˆæå–**ï¼šCF-Connecting-IP > X-Forwarded-For

### å®‰å…¨å¢å¼· ğŸ”’
- **é˜²çˆ¬èŸ²ä¿è­·**ï¼šæœ‰æ•ˆé˜²æ­¢å–®ä¸€çˆ¬èŸ²é‡è¤‡è¨ªå•é€ æˆå¤§é‡ session
- **è³‡æºæ¿«ç”¨é˜²è­·**ï¼šé™åˆ¶æ•æ„Ÿåç‰‡çš„æŸ¥çœ‹æ¬¡æ•¸
- **ç„¡ç¹éæ©Ÿåˆ¶**ï¼šç®¡ç†å“¡æŸ¥çœ‹ä¹Ÿå—å»é‡é™åˆ¶ï¼ˆé˜²æ­¢èª¤æ“ä½œï¼‰
- **ç²¾ç¢ºéŒ¯èª¤æç¤º**ï¼š429 éŒ¯èª¤åŒ…å« retry_after å’Œé™åˆ¶è©³æƒ…

### æŠ€è¡“æ”¹é€² âš¡
- Sliding Window Counter ç®—æ³•ï¼ˆç²¾ç¢ºæ™‚é–“çª—å£ï¼‰
- KV-based å»é‡èˆ‡è¨ˆæ•¸ï¼ˆ60s/120s/7200s TTLï¼‰
- ä¸¦è¡Œæª¢æŸ¥èˆ‡æ“ä½œï¼ˆæå‡æ€§èƒ½ï¼‰
- å®Œæ•´ TypeScript é¡å‹å®šç¾©

## v4.0.1 æ›´æ–°å…§å®¹ (2026-01-19)

### æ–°å¢åŠŸèƒ½
- **é¦–é ç”¢å“ä»‹ç´¹**ï¼šæ–°å¢ã€Œå¦‚ä½•ä½¿ç”¨ã€3 æ­¥é©Ÿèªªæ˜
- **æ ¸å¿ƒç‰¹è‰²å„ªåŒ–**ï¼šæ›´æ–°ç‚ºä½¿ç”¨è€…è¦–è§’çš„ 4 é …å·®ç•°åŒ–å„ªå‹¢
- **LLM å‹å–„æ–‡æª”**ï¼šå‰µå»º `llm.txt` ä¾› AI ç³»çµ±ç†è§£å°ˆæ¡ˆçµæ§‹
- **æ°¸ä¹…åˆªé™¤åŠŸèƒ½**ï¼šç®¡ç†å“¡å¯æ°¸ä¹…åˆªé™¤å·²æ’¤éŠ·çš„åç‰‡ï¼ˆå”åŠ©é‡ç½®ï¼‰

### æ€§èƒ½å„ªåŒ–
- **å‰ç«¯å„ªåŒ–**ï¼šä¸‰å€‹é é¢é˜»å¡è³‡æºå¤§å¹…æ¸›å°‘ï¼ˆ4â†’1, 3â†’1, 6â†’1ï¼‰
- **API å„ªåŒ–**ï¼šTap API æ€§èƒ½æå‡ 72-79%ï¼ˆ7.2s â†’ 1.5-2sï¼‰
- **å¿«å–æ©Ÿåˆ¶**ï¼šRead API ç†±è®€å–æå‡ 44%ï¼ˆ0.9s â†’ 0.5sï¼‰

### æŠ€è¡“æ”¹é€²
- æ·»åŠ  CDN preconnect å„ªåŒ–è¼‰å…¥é€Ÿåº¦
- å»¶é² Three.js åˆå§‹åŒ–ï¼ˆ100msï¼‰
- å¯¦æ–½å®Œæ•´éŸ¿æ‡‰å¿«å–ï¼ˆ60s TTLï¼‰
- éåŒæ­¥ audit logging

## v4.0 æ ¸å¿ƒç‰¹æ€§

### ä¼æ¥­ç´šå®‰å…¨æ¶æ§‹
- **ä¿¡å°åŠ å¯† (Envelope Encryption)**: æ¯å¼µåç‰‡ç¨ç«‹ DEKï¼ŒKEK å®šæœŸè¼ªæ›
- **æˆæ¬Šæœƒè©±æ©Ÿåˆ¶ (ReadSession)**: 24 å°æ™‚ TTLï¼Œå¯æ’¤éŠ·ã€å¯é™åˆ¶åŒæ™‚è®€å–æ•¸
- **å³æ™‚æ’¤éŠ·**: NFC é‡æ–°è§¸ç¢°å³å¯æ’¤éŠ·ä¸Šä¸€å€‹æœƒè©±
- **å¯©è¨ˆæ—¥èªŒ**: å®Œæ•´è¨˜éŒ„æ‰€æœ‰å­˜å–è¡Œç‚ºï¼ŒIP åŒ¿ååŒ–ä¿è­·éš±ç§

### Cloudflare Workers æ¶æ§‹
- **å…¨çƒé‚Šç·£é‹ç®—**: ä½å»¶é²ã€é«˜å¯ç”¨æ€§
- **D1 Database**: SQLite ç›¸å®¹çš„åˆ†æ•£å¼è³‡æ–™åº«
- **ç„¡ä¼ºæœå™¨**: è‡ªå‹•æ“´å±•ï¼ŒæŒ‰éœ€è¨ˆè²»

### ä½¿ç”¨è€…é«”é©—
- **ä¸€è§¸å³ç”¨**: NFC è§¸ç¢°è‡ªå‹•å‰µå»ºæˆæ¬Šæœƒè©±
- **é›™èªæ”¯æ´**: ä¸­è‹±æ–‡å‹•æ…‹åˆ‡æ›
- **é›¢ç·š QR ç¢¼**: ç„¡ç¶²è·¯ç’°å¢ƒä¸‹ç”Ÿæˆ vCard QR ç¢¼
- **æ™ºæ…§ vCard**: è‡ªå‹•ç”Ÿæˆè¯çµ¡äººæª”æ¡ˆ

### ç®¡ç†å¾Œå°
- **å®Œæ•´ CRUD**: å‰µå»ºã€è®€å–ã€æ›´æ–°ã€åˆªé™¤åç‰‡
- **å³æ™‚ç›£æ§**: KEK ç‰ˆæœ¬ã€æ´»èºåç‰‡æ•¸çµ±è¨ˆ
- **ç·Šæ€¥æ’¤éŠ·**: å…¨åŸŸæ’¤éŠ·æ©Ÿåˆ¶
- **HttpOnly Cookies**: XSS é˜²è­·

## å°ˆæ¡ˆçµæ§‹

```
DB-Card/
â”œâ”€â”€ workers/                        # v4.0 æ ¸å¿ƒç³»çµ±
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts                # ä¸»è·¯ç”±èˆ‡ä¸­ä»‹å±¤
â”‚   â”‚   â”œâ”€â”€ types.ts                # TypeScript é¡å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ handlers/               # API è™•ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ tap.ts              # POST /api/nfc/tap
â”‚   â”‚   â”‚   â”œâ”€â”€ read.ts             # GET /api/read
â”‚   â”‚   â”‚   â”œâ”€â”€ health.ts           # GET /health
â”‚   â”‚   â”‚   â””â”€â”€ admin/              # ç®¡ç† API
â”‚   â”‚   â”‚       â”œâ”€â”€ cards.ts        # CRUD æ“ä½œ
â”‚   â”‚   â”‚       â”œâ”€â”€ auth.ts         # ç™»å…¥/ç™»å‡º
â”‚   â”‚   â”‚       â”œâ”€â”€ revoke.ts       # æ’¤éŠ·æ©Ÿåˆ¶
â”‚   â”‚   â”‚       â”œâ”€â”€ kek.ts          # KEK è¼ªæ›
â”‚   â”‚   â”‚       â””â”€â”€ security.ts     # å®‰å…¨ç›£æ§ï¼ˆ7 APIsï¼‰
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # æ™‚åºå®‰å…¨èªè­‰
â”‚   â”‚   â”‚   â””â”€â”€ rate-limit.ts      # é€Ÿç‡é™åˆ¶
â”‚   â”‚   â”œâ”€â”€ crypto/
â”‚   â”‚   â”‚   â””â”€â”€ envelope.ts         # ä¿¡å°åŠ å¯†å¯¦ä½œ
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ session.ts          # æœƒè©±ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ policy.ts           # åç‰‡é¡å‹ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ audit.ts            # å¯©è¨ˆæ—¥èªŒ
â”‚   â”‚       â”œâ”€â”€ rate-limit.ts       # é€Ÿç‡é™åˆ¶ï¼ˆNEW v4.1.0ï¼‰
â”‚   â”‚       â”œâ”€â”€ ip.ts               # IP æå–ï¼ˆNEW v4.1.0ï¼‰
â”‚   â”‚       â””â”€â”€ response.ts         # CORS èˆ‡å›æ‡‰
â”‚   â”œâ”€â”€ public/                     # å‰ç«¯è³‡æº
â”‚   â”‚   â”œâ”€â”€ admin-dashboard.html    # ç®¡ç†å¾Œå°ï¼ˆå«å®‰å…¨ç›£æ§ï¼‰
â”‚   â”‚   â”œâ”€â”€ card-display.html       # åç‰‡é¡¯ç¤ºé 
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.js              # API å®¢æˆ¶ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.js          # IndexedDB
â”‚   â”‚   â”‚   â”œâ”€â”€ main.js             # ä¸»é‚è¼¯ï¼ˆå« i18nï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ validation.js       # è¡¨å–®é©—è­‰
â”‚   â”‚   â”‚   â”œâ”€â”€ error-handler.js    # éŒ¯èª¤è™•ç†
â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â”‚       â””â”€â”€ bilingual.js    # é›™èªå·¥å…·
â”‚   â”‚   â””â”€â”€ css/
â”‚   â”‚       â””â”€â”€ v4-design.css       # v4.0 è¨­è¨ˆç³»çµ±
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ 0001_initial_schema.sql # è³‡æ–™åº«çµæ§‹
â”‚   â”‚   â”œâ”€â”€ 0002_security_events.sql # å®‰å…¨äº‹ä»¶è¡¨
â”‚   â”‚   â””â”€â”€ 0003_blocked_ips.sql    # IP å°é–è¡¨
â”‚   â”œâ”€â”€ wrangler.toml               # Cloudflare é…ç½®
â”‚   â””â”€â”€ package.json                # ä¾è³´ç®¡ç†
â”œâ”€â”€ docs/                           # æŠ€è¡“æ–‡æª”
â”‚   â”œâ”€â”€ adr/                        # æ¶æ§‹æ±ºç­–è¨˜éŒ„
â”‚   â”‚   â”œâ”€â”€ 001-privacy-first.md
â”‚   â”‚   â””â”€â”€ 002-security-architecture.md
â”‚   â””â”€â”€ api/                        # API æ–‡æª”
â”‚       â”œâ”€â”€ nfc-tap.md
â”‚       â”œâ”€â”€ read.md
â”‚       â”œâ”€â”€ admin-apis.md
â”‚       â””â”€â”€ kek-migration.md
â”œâ”€â”€ .specify/                       # é–‹ç™¼è¨˜æ†¶ç³»çµ±
â”‚   â”œâ”€â”€ specs/                      # BDD è¦æ ¼æ›¸
â”‚   â””â”€â”€ memory/                     # çŸ¥è­˜åœ–è­œ
â””â”€â”€ archive/                        # v3.X åƒè€ƒå¯¦ä½œ
    â”œâ”€â”€ v3-frontend/                # ç´”å‰ç«¯ç‰ˆæœ¬
    â”œâ”€â”€ v3-pwa/                     # PWA é›¢ç·šç³»çµ±
    â””â”€â”€ README.md                   # å°å­˜èªªæ˜
```

## å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒæº–å‚™

```bash
# å®‰è£ä¾è³´
cd workers
npm install

# è¨­å®šç’°å¢ƒè®Šæ•¸
cp .dev.vars.example .dev.vars
# ç·¨è¼¯ .dev.vars è¨­å®šä»¥ä¸‹è®Šæ•¸ï¼š
# - SETUP_TOKEN: ç®¡ç†å“¡èªè­‰ token
# - KEK: ä¸»åŠ å¯†é‡‘é‘° (Key Encryption Key)
# - GOOGLE_CLIENT_ID: Google OAuth Client ID
# - GOOGLE_CLIENT_SECRET: Google OAuth Client Secret
# - JWT_SECRET: JWT token ç°½åå¯†é‘° (è‡³å°‘ 32 bytes)

# ç”Ÿæˆ JWT Secret
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

**é‡è¦**ï¼šè«‹åƒé–± [JWT Secret ç®¡ç†æŒ‡å—](docs/JWT_SECRET_MANAGEMENT.md) äº†è§£è©³ç´°çš„å®‰å…¨é…ç½®ã€‚

### 2. æœ¬åœ°é–‹ç™¼

```bash
# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# åŸ·è¡Œæ¸¬è©¦
npm test

# éƒ¨ç½²åˆ° staging
npm run deploy:staging

# éƒ¨ç½²åˆ° production
npm run deploy:production
```

### 3. è³‡æ–™åº«åˆå§‹åŒ–

```bash
# æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
npx wrangler d1 execute DB --local --file=./migrations/0001_initial_schema.sql

# ç”Ÿç”¢ç’°å¢ƒ
npx wrangler d1 execute DB --remote --file=./migrations/0001_initial_schema.sql
```

## ä½¿ç”¨æµç¨‹

### ä½¿ç”¨è€…ç«¯

1. **NFC è§¸ç¢°**: æ‰‹æ©Ÿè§¸ç¢° NFC å¡ç‰‡
2. **è‡ªå‹•æˆæ¬Š**: ç³»çµ±å‰µå»º 24 å°æ™‚æˆæ¬Šæœƒè©±
3. **æŸ¥çœ‹åç‰‡**: ç€è¦½å™¨é–‹å•Ÿåç‰‡é¡¯ç¤ºé 
4. **ä¸‹è¼‰ vCard**: ä¸€éµåŠ å…¥è¯çµ¡äºº
5. **é›¢ç·šåˆ†äº«**: ç”Ÿæˆ vCard QR ç¢¼

### ç®¡ç†ç«¯

1. **ç™»å…¥å¾Œå°**: `https://your-domain/admin-dashboard.html`
2. **å‰µå»ºåç‰‡**: å¡«å¯« 11 å€‹æ¬„ä½ï¼ˆå°é½Š nfc-generatorï¼‰
3. **ç·¨è¼¯åç‰‡**: è¡¨å–®è‡ªå‹•é å¡«ç¾æœ‰è³‡æ–™
4. **æŸ¥çœ‹åç‰‡**: è‡ªå‹•å‰µå»ºæœƒè©±ä¸¦é–‹å•Ÿé è¦½
5. **æ’¤éŠ·æœƒè©±**: ç·Šæ€¥æƒ…æ³ä¸‹å…¨åŸŸæ’¤éŠ·

## å®‰å…¨ç‰¹æ€§

### å¤šå±¤é˜²è­·æ¶æ§‹ (v4.1.0)

NFC Tap API å¯¦ä½œä¸‰å±¤é˜²è­·æ©Ÿåˆ¶ï¼Œæœ‰æ•ˆé˜²æ­¢çˆ¬èŸ²æ¿«ç”¨èˆ‡è³‡æºæ”»æ“Šï¼š

**Layer 1: å»é‡æ©Ÿåˆ¶ (60s)**
- 60 ç§’å…§é‡è¤‡è«‹æ±‚è¿”å›ç›¸åŒ session
- æ¸›å°‘ä¸å¿…è¦çš„è³‡æºæ¶ˆè€—
- é˜²æ­¢èª¤è§¸èˆ‡çˆ¬èŸ²ç¬é–“çˆ†é‡

**Layer 2: é€Ÿç‡é™åˆ¶**
- Card UUID: 10 æ¬¡/åˆ†é˜ã€50 æ¬¡/å°æ™‚
- IP åœ°å€: 10 æ¬¡/åˆ†é˜ã€50 æ¬¡/å°æ™‚
- ä½¿ç”¨ Sliding Window Counter ç®—æ³•
- è¶…é™è¿”å› 429 éŒ¯èª¤ï¼ˆå« retry_afterï¼‰

**Layer 3: ä½µç™¼è®€å–é™åˆ¶**
- ä¾åç‰‡é¡å‹é™åˆ¶åŒæ™‚è®€å–æ•¸
- é˜²æ­¢ session token å¤–æ´©æ¿«ç”¨
- è©³è¦‹ä¸‹æ–¹ã€Œåç‰‡é¡å‹ç­–ç•¥ã€è¡¨æ ¼

### ä¿¡å°åŠ å¯†æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NFC Card (Plaintext card_uuid)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ Tap
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/nfc/tap                      â”‚
â”‚  - Layer 1: Dedup check (60s)           â”‚
â”‚  - Layer 2: Rate limit check            â”‚
â”‚  - Layer 3: Create ReadSession (24h)    â”‚
â”‚  - Return session token                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/read?session={token}          â”‚
â”‚  1. Validate session                    â”‚
â”‚  2. Check concurrent reads (Layer 3)    â”‚
â”‚  3. Fetch encrypted_dek + ciphertext    â”‚
â”‚  4. Unwrap DEK with KEK                 â”‚
â”‚  5. Decrypt card data with DEK          â”‚
â”‚  6. Return plaintext to user            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åç‰‡é¡å‹ç­–ç•¥

| é¡å‹ | TTL | æœ€å¤§åŒæ™‚è®€å–æ•¸ | ä½¿ç”¨å ´æ™¯ |
|------|-----|---------------|---------|
| personal | 24h | 20 | å€‹äººåç‰‡ |
| event_booth | 24h | 50 | å±•æœƒæ”¤ä½ |
| sensitive | 24h | 5 | æ•æ„Ÿè³‡è¨Š |

### æ’¤éŠ·æ©Ÿåˆ¶

- **å–®ä¸€æ’¤éŠ·**: é‡æ–°è§¸ç¢° NFC å¡ç‰‡ï¼ˆ10 åˆ†é˜å…§æˆ– 2 æ¬¡è®€å–å…§ï¼‰
- **å…¨åŸŸæ’¤éŠ·**: ç®¡ç†å¾Œå° `POST /api/admin/revoke`
- **ç·Šæ€¥éŸ¿æ‡‰**: KEK è¼ªæ›ä½¿æ‰€æœ‰èˆŠæœƒè©±å¤±æ•ˆ

## API ç«¯é»

### å…¬é–‹ API

- `POST /api/nfc/tap` - NFC è§¸ç¢°å‰µå»ºæœƒè©±
- `GET /api/read` - è®€å–åç‰‡è³‡æ–™
- `GET /health` - ç³»çµ±å¥åº·æª¢æŸ¥

### ç®¡ç† API (éœ€èªè­‰)

- `POST /api/admin/login` - ç™»å…¥
- `POST /api/admin/logout` - ç™»å‡º
- `GET /api/admin/cards` - åˆ—å‡ºæ‰€æœ‰åç‰‡
- `GET /api/admin/cards/:uuid` - å–å¾—å–®ä¸€åç‰‡
- `POST /api/admin/cards` - å‰µå»ºåç‰‡
- `PUT /api/admin/cards/:uuid` - æ›´æ–°åç‰‡
- `DELETE /api/admin/cards/:uuid` - åˆªé™¤åç‰‡
- `POST /api/admin/revoke` - æ’¤éŠ·æœƒè©±
- `POST /api/admin/kek/rotate` - KEK è¼ªæ›

è©³ç´° API æ–‡æª”è«‹åƒè€ƒ `docs/api/`

## ç›£æ§èˆ‡æ—¥èªŒ

### å¥åº·æª¢æŸ¥

```bash
curl https://your-domain/health
```

å›æ‡‰ç¯„ä¾‹ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2026-01-18T10:30:00.000Z",
  "kek": {
    "version": 1,
    "status": "active"
  },
  "database": {
    "active_cards": 42
  }
}
```

### å¯©è¨ˆæ—¥èªŒ

æ‰€æœ‰æ•æ„Ÿæ“ä½œå‡è¨˜éŒ„æ–¼ `audit_logs` è¡¨ï¼š
- åç‰‡å‰µå»º/æ›´æ–°/åˆªé™¤
- æœƒè©±å‰µå»º/è®€å–
- KEK è¼ªæ›
- IP åœ°å€è‡ªå‹•åŒ¿ååŒ–ï¼ˆä¿ç•™å‰ 3 æ®µï¼‰

## å¾ v3.X é·ç§»

v3.X ç´”å‰ç«¯æ¶æ§‹å·²å°å­˜è‡³ `archive/` ç›®éŒ„ï¼ŒåŒ…å«ï¼š
- PWA é›¢ç·šå„²å­˜ç³»çµ±
- é›™èªç¿»è­¯æ¨¡çµ„
- å®‰å…¨æ¶æ§‹æ¨¡çµ„

v4.0 æ¡ç”¨å¾Œç«¯ API æ¶æ§‹ï¼Œæä¾›æ›´å¼·çš„å®‰å…¨æ€§èˆ‡ç®¡ç†èƒ½åŠ›ã€‚

**ä¸»è¦å·®ç•°**ï¼š
- v3.X: è³‡æ–™å„²å­˜åœ¨ NFC å¡ç‰‡ URL åƒæ•¸ï¼ˆBase64ï¼‰
- v4.0: è³‡æ–™åŠ å¯†å„²å­˜æ–¼ D1 Databaseï¼ŒNFC å¡ç‰‡åƒ…å« UUID

**é·ç§»æ­¥é©Ÿ**ï¼š
1. ä½¿ç”¨ admin-dashboard.html å‰µå»ºæ–°åç‰‡
2. é€éç®¡ç†å¾Œå°å–å¾— card_uuid
3. å°‡ UUID å¯«å…¥ NFC å¡ç‰‡ï¼ˆæ ¼å¼ï¼š`https://your-domain/card-display.html?card={uuid}`ï¼‰

è©³ç´°é·ç§»æŒ‡å—è«‹åƒè€ƒ `archive/README.md`

## æ¸¬è©¦

```bash
# å–®å…ƒæ¸¬è©¦
npm test

# æ•´åˆæ¸¬è©¦
npm run test:integration

# ç«¯å°ç«¯æ¸¬è©¦
npm run test:e2e
```

## é–‹ç™¼æŒ‡å—

### BDD è¦æ ¼é©…å‹•é–‹ç™¼

æ‰€æœ‰åŠŸèƒ½é–‹ç™¼å‡éµå¾ª BDD è¦æ ¼ï¼Œä½æ–¼ `.specify/specs/`ï¼š
- `nfc-tap-api.md` - NFC è§¸ç¢° API
- `read-api.md` - è®€å– API
- `admin-crud-apis.md` - ç®¡ç† CRUD API
- `security-enhancements.md` - å®‰å…¨å¢å¼·

### æ¶æ§‹æ±ºç­–è¨˜éŒ„ (ADR)

é‡è¦æŠ€è¡“æ±ºç­–è¨˜éŒ„æ–¼ `docs/adr/`ï¼š
- ADR-001: éš±ç§å„ªå…ˆè¨­è¨ˆåŸå‰‡
- ADR-002: ä¿¡å°åŠ å¯†æ¶æ§‹

### è¨˜æ†¶ç³»çµ±

é–‹ç™¼éç¨‹ä½¿ç”¨çŸ¥è­˜åœ–è­œè¨˜æ†¶ç³»çµ±ï¼ˆ`.specify/memory/`ï¼‰ï¼š
- `progress.md` - ç•¶å‰é–‹ç™¼é€²åº¦
- `knowledge_graph.mem` - é•·æœŸçŸ¥è­˜æ­¸æª”

## æˆæ¬Šæ¢æ¬¾

MIT License - è©³è¦‹ [LICENSE](LICENSE)

### ç¬¬ä¸‰æ–¹å…ƒä»¶æˆæ¬Š

æœ¬å°ˆæ¡ˆä½¿ç”¨å¤šå€‹é–‹æºå…ƒä»¶èˆ‡å­—é«”ï¼Œæ‰€æœ‰ä¾è³´å‡ç‚ºé–‹æºæˆæ¬Šï¼ˆMITã€ISCã€Apache 2.0ã€SIL OFL 1.1ï¼‰ï¼Œå…è¨±å•†æ¥­ä½¿ç”¨ã€‚

å®Œæ•´çš„ç¬¬ä¸‰æ–¹å…ƒä»¶æ¸…å–®èˆ‡æˆæ¬Šè³‡è¨Šè«‹åƒé–±ï¼š[THIRD_PARTY_LICENSES.md](THIRD_PARTY_LICENSES.md)

## è²¢ç»æŒ‡å—

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork å°ˆæ¡ˆ
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æ’°å¯« BDD è¦æ ¼ï¼ˆ`.specify/specs/`ï¼‰
4. å¯¦ä½œåŠŸèƒ½ä¸¦é€šéæ¸¬è©¦
5. æäº¤è®Šæ›´ (`git commit -m 'feat: add amazing feature'`)
6. æ¨é€åˆ†æ”¯ (`git push origin feature/amazing-feature`)
7. é–‹å•Ÿ Pull Request

## æŠ€è¡“æ”¯æ´

- **æ–‡æª”**: `docs/`
- **Issues**: [GitHub Issues](https://github.com/iim0663418/DB-Card/issues)

## ç‰ˆæœ¬æ­·ç¨‹

### v4.1.0 (2026-01-20) - å¤šå±¤é˜²è­·æ©Ÿåˆ¶
- NFC Tap API ä¸‰å±¤é˜²è­·ï¼ˆDedup + Rate Limit + Max Readsï¼‰
- 60 ç§’å»é‡æ©Ÿåˆ¶ï¼ˆé˜²æ­¢é‡è¤‡è«‹æ±‚ï¼‰
- é›™ç¶­åº¦é€Ÿç‡é™åˆ¶ï¼ˆCard UUID + IP: 10/min, 50/hourï¼‰
- Sliding Window Counter ç®—æ³•
- IP å„ªå…ˆæå–ï¼ˆCF-Connecting-IPï¼‰
- é˜²çˆ¬èŸ²èˆ‡è³‡æºæ¿«ç”¨ä¿è­·
- å®Œæ•´ BDD è¦æ ¼ï¼ˆ11 scenariosï¼‰

### v4.0.1 (2026-01-19) - æ€§èƒ½å„ªåŒ–èˆ‡æ°¸ä¹…åˆªé™¤
- å‰ç«¯æ€§èƒ½å„ªåŒ–ï¼ˆé˜»å¡è³‡æºå¤§å¹…æ¸›å°‘ï¼‰
- API æ€§èƒ½æå‡ï¼ˆTap API 72-79%, Read API 44%ï¼‰
- æ°¸ä¹…åˆªé™¤åŠŸèƒ½ï¼ˆå”åŠ©é‡ç½®ï¼‰
- é¦–é ç”¢å“ä»‹ç´¹å„ªåŒ–
- LLM å‹å–„æ–‡æª”

### v4.0.0 (2026-01-18) - ä¼æ¥­ç´šå®‰å…¨æ¶æ§‹
- ä¿¡å°åŠ å¯†æ©Ÿåˆ¶
- æˆæ¬Šæœƒè©±ç³»çµ±
- å®Œæ•´é›™èªæ”¯æ´ï¼ˆ11 å€‹ i18n keysï¼‰
- å®‰å…¨ç›£æ§å„€è¡¨æ¿ï¼ˆ7 å€‹ APIsï¼‰
- è¡¨å–®é©—è­‰èˆ‡æ¸…ç†
- KEK é·ç§»åŸºç¤è¨­æ–½
- ç®¡ç†å¾Œå°å®Œæ•´ CRUD
- HttpOnly Cookies å®‰å…¨å¢å¼·
- å¯©è¨ˆæ—¥èªŒèˆ‡ç›£æ§

### v3.2.1 (2025-08-09) - PWA ç©©å®šç‰ˆ
- PWA é›¢ç·šå„²å­˜
- é›™èªç¿»è­¯ç³»çµ±
- å®‰å…¨æ¶æ§‹æ¨¡çµ„
- å·²å°å­˜è‡³ `archive/v3-pwa/`

---

**ä¼æ¥­ç´šå®‰å…¨ï¼Œéš±ç§å„ªå…ˆè¨­è¨ˆ**  
**Cloudflare Workers å…¨çƒé‚Šç·£é‹ç®—**
