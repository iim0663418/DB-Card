<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB-Card å®‰å…¨ Headers æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .header-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .recommendations {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ DB-Card å®‰å…¨ Headers æ¸¬è©¦</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç•¶å‰é é¢å®‰å…¨ç‹€æ…‹</h2>
            <button onclick="checkSecurityHeaders()">æª¢æŸ¥å®‰å…¨ Headers</button>
            <button onclick="testCSP()">æ¸¬è©¦ CSP é˜²è­·</button>
            <button onclick="testXSS()">æ¸¬è©¦ XSS é˜²è­·</button>
            <div id="results"></div>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalHeaders">0</div>
                <div>æª¢æ¸¬åˆ°çš„ Headers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="passedHeaders">0</div>
                <div>é€šéçš„ Headers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="securityScore">0%</div>
                <div>å®‰å…¨è©•åˆ†</div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ›¡ï¸ å¿…è¦å®‰å…¨ Headers æª¢æŸ¥</h2>
            <div id="headerChecks"></div>
        </div>

        <div class="recommendations" id="recommendations" style="display: none;">
            <h3>ğŸ’¡ æ”¹å–„å»ºè­°</h3>
            <ul id="recommendationList"></ul>
        </div>

        <div class="test-section">
            <h2>ğŸ” Headers è©³ç´°è³‡è¨Š</h2>
            <div id="headerDetails"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ éƒ¨ç½²å¹³å°é…ç½®æª¢æŸ¥</h2>
            <button onclick="checkDeploymentConfigs()">æª¢æŸ¥éƒ¨ç½²é…ç½®</button>
            <div id="deploymentResults"></div>
        </div>
    </div>

    <script>
        // å¿…è¦çš„å®‰å…¨ Headers é…ç½®
        const REQUIRED_HEADERS = {
            'Content-Security-Policy': {
                name: 'Content-Security-Policy',
                description: 'å…§å®¹å®‰å…¨æ”¿ç­– - é˜²æ­¢ XSS æ”»æ“Š',
                required: true,
                check: (value) => value && value.includes('default-src')
            },
            'Strict-Transport-Security': {
                name: 'Strict-Transport-Security', 
                description: 'HTTP åš´æ ¼å‚³è¼¸å®‰å…¨ - å¼·åˆ¶ HTTPS',
                required: true,
                check: (value) => value && value.includes('max-age=')
            },
            'X-Frame-Options': {
                name: 'X-Frame-Options',
                description: 'é˜²æ­¢é»æ“ŠåŠ«æŒæ”»æ“Š',
                required: true,
                check: (value) => value && (value.toUpperCase() === 'DENY' || value.toUpperCase() === 'SAMEORIGIN')
            },
            'X-Content-Type-Options': {
                name: 'X-Content-Type-Options',
                description: 'é˜²æ­¢ MIME é¡å‹æ··æ·†æ”»æ“Š',
                required: true,
                check: (value) => value && value.toLowerCase() === 'nosniff'
            },
            'Referrer-Policy': {
                name: 'Referrer-Policy',
                description: 'æ§åˆ¶ Referrer è³‡è¨Šæ´©éœ²',
                required: true,
                check: (value) => value && value.includes('strict-origin')
            }
        };

        // æª¢æŸ¥å®‰å…¨ Headers
        async function checkSecurityHeaders() {
            const resultsDiv = document.getElementById('results');
            const statsDiv = document.getElementById('stats');
            const headerChecksDiv = document.getElementById('headerChecks');
            const headerDetailsDiv = document.getElementById('headerDetails');
            const recommendationsDiv = document.getElementById('recommendations');
            const recommendationList = document.getElementById('recommendationList');
            
            resultsDiv.innerHTML = '<p>ğŸ” æ­£åœ¨æª¢æŸ¥å®‰å…¨ Headers...</p>';
            
            try {
                // ä½¿ç”¨ fetch ç²å–ç•¶å‰é é¢çš„ Headers
                const response = await fetch(window.location.href, { method: 'HEAD' });
                const headers = {};
                
                // æ³¨æ„ï¼šç”±æ–¼ CORS é™åˆ¶ï¼Œæˆ‘å€‘ç„¡æ³•ç›´æ¥è®€å–æ‰€æœ‰ Headers
                // é€™è£¡æ¨¡æ“¬æª¢æŸ¥éç¨‹
                resultsDiv.innerHTML = '<div class="warning">âš ï¸ ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œç„¡æ³•ç›´æ¥è®€å– Response Headersã€‚è«‹ä½¿ç”¨é–‹ç™¼è€…å·¥å…·æ‰‹å‹•æª¢æŸ¥ã€‚</div>';
                
                // é¡¯ç¤ºæª¢æŸ¥æŒ‡å—
                let checkGuide = '<h3>ğŸ“‹ æ‰‹å‹•æª¢æŸ¥æ­¥é©Ÿï¼š</h3>';
                checkGuide += '<ol>';
                checkGuide += '<li>æŒ‰ F12 é–‹å•Ÿé–‹ç™¼è€…å·¥å…·</li>';
                checkGuide += '<li>åˆ‡æ›åˆ° Network æ¨™ç±¤</li>';
                checkGuide += '<li>é‡æ–°è¼‰å…¥é é¢</li>';
                checkGuide += '<li>é»æ“Šä¸»æ–‡æª”è«‹æ±‚</li>';
                checkGuide += '<li>æª¢æŸ¥ Response Headers</li>';
                checkGuide += '</ol>';
                
                resultsDiv.innerHTML += checkGuide;
                
                // é¡¯ç¤ºå¿…è¦ Headers æ¸…å–®
                let headerCheckHtml = '';
                Object.entries(REQUIRED_HEADERS).forEach(([key, config]) => {
                    headerCheckHtml += `
                        <div class="test-result warning">
                            <strong>${config.name}</strong><br>
                            ${config.description}<br>
                            <small>è«‹åœ¨é–‹ç™¼è€…å·¥å…·ä¸­ç¢ºèªæ­¤ Header æ˜¯å¦å­˜åœ¨</small>
                        </div>
                    `;
                });
                
                headerChecksDiv.innerHTML = headerCheckHtml;
                statsDiv.style.display = 'grid';
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="fail">âŒ æª¢æŸ¥å¤±æ•—: ${error.message}</div>`;
            }
        }

        // æ¸¬è©¦ CSP é˜²è­·
        function testCSP() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // å˜—è©¦åŸ·è¡Œå…§è¯è…³æœ¬ï¼ˆå¦‚æœ CSP æ­£ç¢ºé…ç½®ï¼Œé€™æ‡‰è©²è¢«é˜»æ­¢ï¼‰
                const script = document.createElement('script');
                script.innerHTML = 'console.log("CSP test script executed");';
                document.head.appendChild(script);
                
                resultsDiv.innerHTML += '<div class="warning">âš ï¸ CSP æ¸¬è©¦ï¼šå…§è¯è…³æœ¬å¯èƒ½è¢«åŸ·è¡Œï¼ˆæª¢æŸ¥æ§åˆ¶å°ï¼‰</div>';
            } catch (error) {
                resultsDiv.innerHTML += '<div class="pass">âœ… CSP æ¸¬è©¦ï¼šå…§è¯è…³æœ¬è¢«æ­£ç¢ºé˜»æ­¢</div>';
            }
        }

        // æ¸¬è©¦ XSS é˜²è­·
        function testXSS() {
            const resultsDiv = document.getElementById('results');
            
            // æ¸¬è©¦å¸¸è¦‹çš„ XSS å‘é‡
            const xssPayloads = [
                '<script>alert("XSS")</script>',
                '<img src="x" onerror="alert(\'XSS\')">',
                'javascript:alert("XSS")'
            ];
            
            let testResults = '<h4>ğŸ›¡ï¸ XSS é˜²è­·æ¸¬è©¦çµæœï¼š</h4>';
            
            xssPayloads.forEach((payload, index) => {
                try {
                    // å‰µå»ºä¸€å€‹å®‰å…¨çš„æ¸¬è©¦ç’°å¢ƒ
                    const testDiv = document.createElement('div');
                    testDiv.innerHTML = payload;
                    
                    if (testDiv.innerHTML === payload) {
                        testResults += `<div class="fail">âŒ æ¸¬è©¦ ${index + 1}: å¯èƒ½å­˜åœ¨ XSS é¢¨éšª</div>`;
                    } else {
                        testResults += `<div class="pass">âœ… æ¸¬è©¦ ${index + 1}: XSS è¼‰è·è¢«æ­£ç¢ºæ¸…ç†</div>`;
                    }
                } catch (error) {
                    testResults += `<div class="pass">âœ… æ¸¬è©¦ ${index + 1}: XSS è¼‰è·è¢«é˜»æ­¢</div>`;
                }
            });
            
            resultsDiv.innerHTML += testResults;
        }

        // æª¢æŸ¥éƒ¨ç½²é…ç½®
        function checkDeploymentConfigs() {
            const deploymentResults = document.getElementById('deploymentResults');
            
            const configs = [
                { name: 'GitHub Pages', file: '_headers', status: 'unknown' },
                { name: 'Netlify', file: 'netlify.toml', status: 'unknown' },
                { name: 'Vercel', file: 'vercel.json', status: 'unknown' },
                { name: 'Cloudflare Pages', file: '_headers', status: 'unknown' },
                { name: 'AWS CloudFront', file: 'cloudformation.yml', status: 'unknown' }
            ];
            
            let configHtml = '<h4>ğŸ“‹ éƒ¨ç½²é…ç½®ç‹€æ…‹ï¼š</h4>';
            
            configs.forEach(config => {
                configHtml += `
                    <div class="test-result warning">
                        <strong>${config.name}</strong><br>
                        é…ç½®æ–‡ä»¶: ${config.file}<br>
                        <small>è«‹ç¢ºèªé…ç½®æ–‡ä»¶å·²æ­£ç¢ºéƒ¨ç½²åˆ°ç›®æ¨™å¹³å°</small>
                    </div>
                `;
            });
            
            configHtml += `
                <div class="header-info">
                    <strong>é©—è­‰å‘½ä»¤ï¼š</strong><br>
                    node deployment/validate-headers.js https://your-domain.com
                </div>
            `;
            
            deploymentResults.innerHTML = configHtml;
        }

        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºåŸºæœ¬è³‡è¨Š
        window.addEventListener('load', function() {
            const headerDetailsDiv = document.getElementById('headerDetails');
            
            let detailsHtml = '<h4>ğŸŒ ç•¶å‰é é¢è³‡è¨Šï¼š</h4>';
            detailsHtml += `<div class="header-info">`;
            detailsHtml += `URL: ${window.location.href}<br>`;
            detailsHtml += `Protocol: ${window.location.protocol}<br>`;
            detailsHtml += `Host: ${window.location.host}<br>`;
            detailsHtml += `User Agent: ${navigator.userAgent}<br>`;
            detailsHtml += `</div>`;
            
            detailsHtml += '<p><strong>ğŸ’¡ æç¤ºï¼š</strong>é€™æ˜¯ä¸€å€‹æœ¬åœ°æ¸¬è©¦é é¢ã€‚å¯¦éš›çš„å®‰å…¨ Headers æª¢æŸ¥éœ€è¦åœ¨éƒ¨ç½²å¾Œçš„ç¶²ç«™ä¸Šé€²è¡Œã€‚</p>';
            
            headerDetailsDiv.innerHTML = detailsHtml;
        });
    </script>
</body>
</html>