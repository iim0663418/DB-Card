<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFFLINE-04 PWA æ•´åˆæ¸¬è©¦èˆ‡å‚™ç”¨æ©Ÿåˆ¶é©—è­‰</title>
    <script src="../../assets/qrcode.min.js"></script>
    <script src="../../assets/qr-utils.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .test-result { margin: 8px 0; padding: 8px; border-radius: 4px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        #qrcode { margin: 20px 0; min-height: 260px; border: 1px solid #ccc; padding: 10px; }
        .qr-label { font-size: 14px; color: #666; margin-top: 10px; }
        button { margin: 5px; padding: 8px 16px; cursor: pointer; }
        .test-controls { margin: 15px 0; }
        .pwa-status { background: #e7f3ff; padding: 10px; margin: 10px 0; border-left: 4px solid #0066cc; }
        .performance-metrics { background: #f0f8f0; padding: 10px; margin: 10px 0; border-left: 4px solid #28a745; }
        .error-simulation { background: #fff0f0; padding: 10px; margin: 10px 0; border-left: 4px solid #dc3545; }
    </style>
</head>
<body>
    <h1>OFFLINE-04 PWA æ•´åˆæ¸¬è©¦èˆ‡å‚™ç”¨æ©Ÿåˆ¶é©—è­‰</h1>
    
    <div class="test-section">
        <h2>ğŸ”§ æ¸¬è©¦æ§åˆ¶é¢æ¿</h2>
        <div class="test-controls">
            <button onclick="runAllPWATests()">åŸ·è¡Œå®Œæ•´ PWA æ¸¬è©¦</button>
            <button onclick="testPWAToolsAvailability()">PWA å·¥å…·å¯ç”¨æ€§</button>
            <button onclick="testPWAQRGeneration()">PWA QR ç¢¼ç”Ÿæˆ</button>
            <button onclick="testFallbackMechanism()">å‚™ç”¨æ©Ÿåˆ¶æ¸¬è©¦</button>
            <button onclick="testErrorRecovery()">éŒ¯èª¤æ¢å¾©æ¸¬è©¦</button>
            <button onclick="testPerformanceMetrics()">æ•ˆèƒ½æ¸¬è©¦</button>
            <button onclick="clearResults()">æ¸…é™¤çµæœ</button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š PWA å·¥å…·ç‹€æ…‹</h2>
        <div class="pwa-status" id="pwa-status">æª¢æŸ¥ä¸­...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ˆ æ•ˆèƒ½æŒ‡æ¨™</h2>
        <div class="performance-metrics" id="performance-metrics">ç­‰å¾…æ¸¬è©¦...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” QR ç¢¼é¡¯ç¤ºå€åŸŸ</h2>
        <div id="qrcode">QR ç¢¼å°‡åœ¨æ­¤é¡¯ç¤º...</div>
        <div class="qr-label" id="qr-label">ç­‰å¾…æ¸¬è©¦é–‹å§‹</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ æ¸¬è©¦çµæœ</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>âš ï¸ éŒ¯èª¤æ¨¡æ“¬æ¸¬è©¦</h2>
        <div class="error-simulation" id="error-simulation">ç­‰å¾…éŒ¯èª¤æ¨¡æ“¬æ¸¬è©¦...</div>
    </div>

    <script>
        // æ¸¬è©¦çµæœæ”¶é›†
        let testResults = [];
        let performanceMetrics = {};
        
        // æ¨¡æ“¬åç‰‡è³‡æ–™
        window.getCardDataFromNFC = function() {
            return {
                data: {
                    name: "PWAæ¸¬è©¦ä½¿ç”¨è€…",
                    title: "ç³»çµ±æ•´åˆå·¥ç¨‹å¸«",
                    department: "è³‡è¨Šè™•",
                    organization: "æ•¸ä½ç™¼å±•éƒ¨",
                    email: "pwa-test@moda.gov.tw",
                    phone: "02-2356-5000",
                    mobile: "0912-345-678",
                    avatar: "assets/wu_sheng_fan/photo.jpg",
                    address: "100057è‡ºåŒ—å¸‚ä¸­æ­£å€å»¶å¹³å—è·¯143è™Ÿ",
                    greetings: ["PWA æ•´åˆæ¸¬è©¦", "æ™ºæ…§å‚™ç”¨æ©Ÿåˆ¶é©—è­‰"],
                    socialLinks: {
                        email: "mailto:pwa-test@moda.gov.tw",
                        socialNote: "LINE: @pwatest\\nFB: fb.com/pwatest"
                    }
                }
            };
        };
        
        // æ¨¡æ“¬ç¾æœ‰ vCard ç”Ÿæˆå‡½æ•¸
        window.generateVCardContent = function(cardData) {
            const data = cardData.data;
            return [
                'BEGIN:VCARD',
                'VERSION:3.0',
                `FN:${data.name}`,
                `ORG:${data.organization}`,
                `TITLE:${data.title}`,
                `EMAIL:${data.email}`,
                `TEL:${data.phone}`,
                `TEL:${data.mobile}`,
                'END:VCARD'
            ].join('\\r\\n');
        };
        
        // è¼‰å…¥å¢å¼·è…³æœ¬
        const script = document.createElement('script');
        script.src = '../../assets/offline-qr-enhancement.js';
        script.onload = function() {
            addResult('info', 'âœ… é›¢ç·š QR ç¢¼å¢å¼·è…³æœ¬è¼‰å…¥æˆåŠŸ');
            checkPWAToolsStatus();
        };
        script.onerror = function() {
            addResult('fail', 'âŒ é›¢ç·š QR ç¢¼å¢å¼·è…³æœ¬è¼‰å…¥å¤±æ•—');
        };
        document.head.appendChild(script);
        
        function addResult(type, message) {
            const container = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            container.appendChild(div);
            
            testResults.push({ type, message, timestamp: new Date() });
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('performance-metrics').textContent = 'ç­‰å¾…æ¸¬è©¦...';
            document.getElementById('error-simulation').textContent = 'ç­‰å¾…éŒ¯èª¤æ¨¡æ“¬æ¸¬è©¦...';
            testResults = [];
            performanceMetrics = {};
            addResult('info', 'æ¸¬è©¦çµæœå·²æ¸…é™¤');
        }
        
        // æª¢æŸ¥ PWA å·¥å…·ç‹€æ…‹
        function checkPWAToolsStatus() {
            const statusContainer = document.getElementById('pwa-status');
            
            const status = {
                qrUtils: !!window.qrUtils,
                generateHighResQRCode: !!(window.qrUtils && window.qrUtils.generateHighResQRCode),
                downloadQRCode: !!(window.qrUtils && window.qrUtils.downloadQRCode),
                generateSmartFilename: !!(window.qrUtils && window.qrUtils.generateSmartFilename),
                offlineTools: !!window.OfflineToolsManager
            };
            
            let statusHtml = '<h4>ğŸ” PWA å·¥å…·å¯ç”¨æ€§æª¢æŸ¥</h4>';
            Object.entries(status).forEach(([key, available]) => {
                const icon = available ? 'âœ…' : 'âŒ';
                const color = available ? 'green' : 'red';
                statusHtml += `<div style="color: ${color};">${icon} ${key}: ${available ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</div>`;
            });
            
            statusContainer.innerHTML = statusHtml;
            
            // è¨˜éŒ„æ•´é«”ç‹€æ…‹
            const availableCount = Object.values(status).filter(Boolean).length;
            const totalCount = Object.keys(status).length;
            
            if (availableCount === totalCount) {
                addResult('pass', `âœ… PWA å·¥å…·å®Œæ•´å¯ç”¨ (${availableCount}/${totalCount})`);
            } else if (availableCount > 0) {
                addResult('warning', `âš ï¸ PWA å·¥å…·éƒ¨åˆ†å¯ç”¨ (${availableCount}/${totalCount})`);
            } else {
                addResult('fail', `âŒ PWA å·¥å…·å®Œå…¨ä¸å¯ç”¨ (${availableCount}/${totalCount})`);
            }
            
            return status;
        }
        
        // æ¸¬è©¦ PWA å·¥å…·å¯ç”¨æ€§
        function testPWAToolsAvailability() {
            addResult('info', 'ğŸ” é–‹å§‹æ¸¬è©¦ PWA å·¥å…·å¯ç”¨æ€§...');
            
            const status = checkPWAToolsStatus();
            
            // è©³ç´°æª¢æŸ¥æ¯å€‹å·¥å…·
            if (window.qrUtils) {
                addResult('pass', 'âœ… qrUtils ç‰©ä»¶å­˜åœ¨');
                
                if (typeof window.qrUtils.generateHighResQRCode === 'function') {
                    addResult('pass', 'âœ… generateHighResQRCode å‡½æ•¸å¯ç”¨');
                } else {
                    addResult('fail', 'âŒ generateHighResQRCode å‡½æ•¸ä¸å­˜åœ¨');
                }
                
                if (typeof window.qrUtils.downloadQRCode === 'function') {
                    addResult('pass', 'âœ… downloadQRCode å‡½æ•¸å¯ç”¨');
                } else {
                    addResult('warning', 'âš ï¸ downloadQRCode å‡½æ•¸ä¸å­˜åœ¨');
                }
                
                if (typeof window.qrUtils.generateSmartFilename === 'function') {
                    addResult('pass', 'âœ… generateSmartFilename å‡½æ•¸å¯ç”¨');
                } else {
                    addResult('warning', 'âš ï¸ generateSmartFilename å‡½æ•¸ä¸å­˜åœ¨');
                }
            } else {
                addResult('fail', 'âŒ qrUtils ç‰©ä»¶ä¸å­˜åœ¨');
            }
        }
        
        // æ¸¬è©¦ PWA QR ç¢¼ç”Ÿæˆ
        async function testPWAQRGeneration() {
            addResult('info', 'ğŸ¨ é–‹å§‹æ¸¬è©¦ PWA QR ç¢¼ç”Ÿæˆ...');
            
            if (!window.qrUtils || !window.qrUtils.generateHighResQRCode) {
                addResult('fail', 'âŒ PWA QR å·¥å…·ä¸å¯ç”¨ï¼Œè·³éæ¸¬è©¦');
                return;
            }
            
            try {
                const startTime = performance.now();
                
                // è¨­å®šé›¢ç·šç‹€æ…‹
                Object.defineProperty(navigator, 'onLine', { 
                    value: false, 
                    configurable: true 
                });
                
                // åŸ·è¡Œ QR ç¢¼ç”Ÿæˆ
                window.generateQRCode();
                
                // ç­‰å¾…ç”Ÿæˆå®Œæˆ
                setTimeout(async () => {
                    const endTime = performance.now();
                    const generationTime = endTime - startTime;
                    
                    // æª¢æŸ¥æ˜¯å¦ç”ŸæˆæˆåŠŸ
                    const qrContainer = document.getElementById('qrcode');
                    const hasQRCode = qrContainer.querySelector('img') || qrContainer.querySelector('canvas');
                    
                    if (hasQRCode) {
                        addResult('pass', `âœ… PWA QR ç¢¼ç”ŸæˆæˆåŠŸ (${Math.round(generationTime)}ms)`);
                        
                        // è¨˜éŒ„æ•ˆèƒ½æŒ‡æ¨™
                        performanceMetrics.pwaGeneration = generationTime;
                        updatePerformanceMetrics();
                        
                        // æª¢æŸ¥ QR ç¢¼å“è³ª
                        const img = qrContainer.querySelector('img');
                        if (img && img.src.startsWith('data:image/')) {
                            addResult('pass', 'âœ… PWA QR ç¢¼æ ¼å¼æ­£ç¢º (DataURL)');
                            
                            // æª¢æŸ¥åœ–ç‰‡å°ºå¯¸
                            img.onload = function() {
                                if (this.naturalWidth === 240 && this.naturalHeight === 240) {
                                    addResult('pass', 'âœ… PWA QR ç¢¼å°ºå¯¸æ­£ç¢º (240x240)');
                                } else {
                                    addResult('warning', `âš ï¸ PWA QR ç¢¼å°ºå¯¸ç•°å¸¸ (${this.naturalWidth}x${this.naturalHeight})`);
                                }
                            };
                        }
                    } else {
                        addResult('fail', 'âŒ PWA QR ç¢¼ç”Ÿæˆå¤±æ•—');
                    }
                    
                    // æ¢å¾©ç·šä¸Šç‹€æ…‹
                    Object.defineProperty(navigator, 'onLine', { value: true, configurable: true });
                }, 2000);
                
            } catch (error) {
                addResult('fail', `âŒ PWA QR ç¢¼ç”Ÿæˆç•°å¸¸: ${error.message}`);
            }
        }
        
        // æ¸¬è©¦å‚™ç”¨æ©Ÿåˆ¶
        function testFallbackMechanism() {
            addResult('info', 'ğŸ”„ é–‹å§‹æ¸¬è©¦å‚™ç”¨æ©Ÿåˆ¶...');
            
            // æš«æ™‚ç¦ç”¨ PWA å·¥å…·
            const originalQrUtils = window.qrUtils;
            window.qrUtils = null;
            
            try {
                const startTime = performance.now();
                
                // è¨­å®šé›¢ç·šç‹€æ…‹
                Object.defineProperty(navigator, 'onLine', { 
                    value: false, 
                    configurable: true 
                });
                
                // åŸ·è¡Œ QR ç¢¼ç”Ÿæˆï¼ˆæ‡‰è©²ä½¿ç”¨å‚™ç”¨æ©Ÿåˆ¶ï¼‰
                window.generateQRCode();
                
                setTimeout(() => {
                    const endTime = performance.now();
                    const fallbackTime = endTime - startTime;
                    
                    // æª¢æŸ¥å‚™ç”¨æ©Ÿåˆ¶æ˜¯å¦å·¥ä½œ
                    const qrContainer = document.getElementById('qrcode');
                    const hasQRCode = qrContainer.querySelector('img') || qrContainer.querySelector('canvas');
                    
                    if (hasQRCode) {
                        addResult('pass', `âœ… å‚™ç”¨æ©Ÿåˆ¶æ­£å¸¸å·¥ä½œ (${Math.round(fallbackTime)}ms)`);
                        
                        // è¨˜éŒ„æ•ˆèƒ½æŒ‡æ¨™
                        performanceMetrics.fallbackGeneration = fallbackTime;
                        updatePerformanceMetrics();
                        
                        // æª¢æŸ¥æ˜¯å¦ä½¿ç”¨äº†åŸå§‹ QRCode æ–¹æ³•
                        const canvas = qrContainer.querySelector('canvas');
                        if (canvas) {
                            addResult('pass', 'âœ… å‚™ç”¨æ©Ÿåˆ¶ä½¿ç”¨åŸå§‹ QRCode æ–¹æ³•');
                        }
                    } else {
                        addResult('fail', 'âŒ å‚™ç”¨æ©Ÿåˆ¶å¤±æ•—');
                    }
                    
                    // æ¢å¾© PWA å·¥å…·å’Œç·šä¸Šç‹€æ…‹
                    window.qrUtils = originalQrUtils;
                    Object.defineProperty(navigator, 'onLine', { value: true, configurable: true });
                    
                }, 1500);
                
            } catch (error) {
                addResult('fail', `âŒ å‚™ç”¨æ©Ÿåˆ¶æ¸¬è©¦ç•°å¸¸: ${error.message}`);
                
                // ç¢ºä¿æ¢å¾©
                window.qrUtils = originalQrUtils;
                Object.defineProperty(navigator, 'onLine', { value: true, configurable: true });
            }
        }
        
        // æ¸¬è©¦éŒ¯èª¤æ¢å¾©
        function testErrorRecovery() {
            addResult('info', 'ğŸ› ï¸ é–‹å§‹æ¸¬è©¦éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶...');
            
            const errorSimulation = document.getElementById('error-simulation');
            let errorTests = [];
            
            // æ¸¬è©¦ 1: QRCode ç‰©ä»¶ä¸å­˜åœ¨
            const originalQRCode = window.QRCode;
            window.QRCode = null;
            
            try {
                Object.defineProperty(navigator, 'onLine', { value: false, configurable: true });
                window.generateQRCode();
                
                setTimeout(() => {
                    errorTests.push('QRCode ç‰©ä»¶ä¸å­˜åœ¨: ç³»çµ±æœªå´©æ½° âœ…');
                    
                    // æ¢å¾©ä¸¦ç¹¼çºŒä¸‹ä¸€å€‹æ¸¬è©¦
                    window.QRCode = originalQRCode;
                    
                    // æ¸¬è©¦ 2: ç„¡æ•ˆçš„åç‰‡è³‡æ–™
                    const originalGetCardData = window.getCardDataFromNFC;
                    window.getCardDataFromNFC = () => null;
                    
                    try {
                        window.generateQRCode();
                        errorTests.push('ç„¡æ•ˆåç‰‡è³‡æ–™: æ­£ç¢ºè™•ç† âœ…');
                    } catch (error) {
                        errorTests.push('ç„¡æ•ˆåç‰‡è³‡æ–™: éŒ¯èª¤è¢«æ•ç² âœ…');
                    }
                    
                    // æ¢å¾©
                    window.getCardDataFromNFC = originalGetCardData;
                    Object.defineProperty(navigator, 'onLine', { value: true, configurable: true });
                    
                    // é¡¯ç¤ºéŒ¯èª¤æ¸¬è©¦çµæœ
                    errorSimulation.innerHTML = '<h4>ğŸ› ï¸ éŒ¯èª¤æ¢å¾©æ¸¬è©¦çµæœ</h4>' + 
                        errorTests.map(test => `<div>â€¢ ${test}</div>`).join('');
                    
                    if (errorTests.length > 0) {
                        addResult('pass', `âœ… éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶æ­£å¸¸ (${errorTests.length} é …æ¸¬è©¦é€šé)`);
                    }
                    
                }, 1000);
                
            } catch (error) {
                addResult('pass', `âœ… éŒ¯èª¤è¢«æ­£ç¢ºæ•ç²: ${error.message}`);
                
                // ç¢ºä¿æ¢å¾©
                window.QRCode = originalQRCode;
                Object.defineProperty(navigator, 'onLine', { value: true, configurable: true });
            }
        }
        
        // æ¸¬è©¦æ•ˆèƒ½æŒ‡æ¨™
        function testPerformanceMetrics() {
            addResult('info', 'ğŸ“Š é–‹å§‹æ•ˆèƒ½æ¸¬è©¦...');
            
            const tests = [
                { name: 'PWA QR ç”Ÿæˆ', threshold: 2000, test: testPWAQRGeneration },
                { name: 'å‚™ç”¨æ©Ÿåˆ¶', threshold: 3000, test: testFallbackMechanism }
            ];
            
            let completedTests = 0;
            
            tests.forEach((testCase, index) => {
                setTimeout(async () => {
                    const startTime = performance.now();
                    
                    try {
                        await testCase.test();
                        
                        const endTime = performance.now();
                        const duration = endTime - startTime;
                        
                        if (duration <= testCase.threshold) {
                            addResult('pass', `âœ… ${testCase.name}æ•ˆèƒ½æ¸¬è©¦é€šé (${Math.round(duration)}ms â‰¤ ${testCase.threshold}ms)`);
                        } else {
                            addResult('warning', `âš ï¸ ${testCase.name}æ•ˆèƒ½æ¸¬è©¦è¶…æ™‚ (${Math.round(duration)}ms > ${testCase.threshold}ms)`);
                        }
                        
                        performanceMetrics[testCase.name] = duration;
                        
                    } catch (error) {
                        addResult('fail', `âŒ ${testCase.name}æ•ˆèƒ½æ¸¬è©¦å¤±æ•—: ${error.message}`);
                    }
                    
                    completedTests++;
                    if (completedTests === tests.length) {
                        updatePerformanceMetrics();
                        generatePerformanceReport();
                    }
                    
                }, index * 3000); // éŒ¯é–‹åŸ·è¡Œæ™‚é–“
            });
        }
        
        // æ›´æ–°æ•ˆèƒ½æŒ‡æ¨™é¡¯ç¤º
        function updatePerformanceMetrics() {
            const container = document.getElementById('performance-metrics');
            
            if (Object.keys(performanceMetrics).length === 0) {
                container.textContent = 'ç­‰å¾…æ¸¬è©¦...';
                return;
            }
            
            let html = '<h4>ğŸ“Š æ•ˆèƒ½æŒ‡æ¨™</h4>';
            Object.entries(performanceMetrics).forEach(([key, value]) => {
                const threshold = key.includes('PWA') ? 2000 : 3000;
                const status = value <= threshold ? 'âœ…' : 'âš ï¸';
                const color = value <= threshold ? 'green' : 'orange';
                
                html += `<div style="color: ${color};">${status} ${key}: ${Math.round(value)}ms (é–€æª»: ${threshold}ms)</div>`;
            });
            
            container.innerHTML = html;
        }
        
        // ç”Ÿæˆæ•ˆèƒ½å ±å‘Š
        function generatePerformanceReport() {
            const metrics = Object.entries(performanceMetrics);
            const avgTime = metrics.reduce((sum, [, time]) => sum + time, 0) / metrics.length;
            
            addResult('info', `ğŸ“Š æ•ˆèƒ½æ¸¬è©¦å®Œæˆï¼Œå¹³å‡æ™‚é–“: ${Math.round(avgTime)}ms`);
            
            // æª¢æŸ¥æ˜¯å¦ç¬¦åˆè¦æ±‚
            const pwaTime = performanceMetrics['PWA QR ç”Ÿæˆ'] || performanceMetrics.pwaGeneration;
            const fallbackTime = performanceMetrics['å‚™ç”¨æ©Ÿåˆ¶'] || performanceMetrics.fallbackGeneration;
            
            if (pwaTime && pwaTime <= 2000) {
                addResult('pass', 'âœ… PWA QR ç¢¼ç”Ÿæˆæ•ˆèƒ½ç¬¦åˆè¦æ±‚ (â‰¤ 2ç§’)');
            }
            
            if (fallbackTime && fallbackTime <= 3000) {
                addResult('pass', 'âœ… å‚™ç”¨æ©Ÿåˆ¶æ•ˆèƒ½ç¬¦åˆè¦æ±‚ (â‰¤ 3ç§’)');
            }
        }
        
        // åŸ·è¡Œå®Œæ•´ PWA æ¸¬è©¦å¥—ä»¶
        function runAllPWATests() {
            clearResults();
            addResult('info', 'ğŸš€ é–‹å§‹åŸ·è¡Œå®Œæ•´ PWA æ•´åˆæ¸¬è©¦å¥—ä»¶...');
            
            // æŒ‰é †åºåŸ·è¡Œæ¸¬è©¦
            setTimeout(() => testPWAToolsAvailability(), 500);
            setTimeout(() => testPWAQRGeneration(), 2000);
            setTimeout(() => testFallbackMechanism(), 5000);
            setTimeout(() => testErrorRecovery(), 8000);
            setTimeout(() => generateFinalReport(), 12000);
        }
        
        // ç”Ÿæˆæœ€çµ‚æ¸¬è©¦å ±å‘Š
        function generateFinalReport() {
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.type === 'pass').length;
            const failedTests = testResults.filter(r => r.type === 'fail').length;
            const warningTests = testResults.filter(r => r.type === 'warning').length;
            
            addResult('info', 'ğŸ“‹ PWA æ•´åˆæ¸¬è©¦å ±å‘Šç”Ÿæˆä¸­...');
            
            setTimeout(() => {
                addResult('info', `
                    ğŸ“Š <strong>PWA æ•´åˆæ¸¬è©¦ç¸½çµ</strong><br>
                    â€¢ ç¸½æ¸¬è©¦æ•¸: ${totalTests}<br>
                    â€¢ é€šé: ${passedTests}<br>
                    â€¢ å¤±æ•—: ${failedTests}<br>
                    â€¢ è­¦å‘Š: ${warningTests}<br>
                    â€¢ æˆåŠŸç‡: ${totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0}%
                `);
                
                if (failedTests === 0) {
                    addResult('pass', 'ğŸ‰ OFFLINE-04 PWA æ•´åˆæ¸¬è©¦èˆ‡å‚™ç”¨æ©Ÿåˆ¶é©—è­‰ï¼šå…¨éƒ¨é€šéï¼');
                } else {
                    addResult('warning', `âš ï¸ OFFLINE-04 æ¸¬è©¦å®Œæˆï¼Œç™¼ç¾ ${failedTests} å€‹å•é¡Œéœ€è¦è™•ç†`);
                }
            }, 1000);
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            addResult('info', 'ğŸ”§ OFFLINE-04 PWA æ•´åˆæ¸¬è©¦ç’°å¢ƒå·²æº–å‚™å°±ç·’');
            addResult('info', 'ğŸ’¡ é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦ï¼Œæˆ–åŸ·è¡Œå®Œæ•´ PWA æ¸¬è©¦å¥—ä»¶');
        });
    </script>
</body>
</html>