stateDiagram-v2
    [*] --> PWALoaded: PWA 載入完成
    PWALoaded --> CheckSupport: 檢查 PWA 支援
    
    CheckSupport --> Supported: 支援 PWA
    CheckSupport --> NotSupported: 不支援 PWA
    
    NotSupported --> [*]: 不顯示提示
    
    Supported --> WaitingPrompt: 等待安裝提示事件
    WaitingPrompt --> PromptTriggered: beforeinstallprompt 觸發
    
    PromptTriggered --> CheckDOM: 檢查 DOM 元素
    CheckDOM --> DOMExists: 元素存在
    CheckDOM --> DOMNotExists: 元素不存在
    
    DOMNotExists --> [*]: 安全退出
    
    DOMExists --> CheckInstalled: 檢查是否已安裝
    CheckInstalled --> AlreadyInstalled: 已安裝
    CheckInstalled --> NotInstalled: 未安裝
    
    AlreadyInstalled --> HidePrompt: 隱藏提示
    NotInstalled --> ShowPrompt: 顯示安裝提示
    
    ShowPrompt --> UserAction: 等待用戶操作
    UserAction --> InstallClicked: 點擊安裝
    UserAction --> DismissClicked: 點擊稍後
    
    InstallClicked --> InstallDialog: 顯示系統安裝對話框
    InstallDialog --> InstallComplete: 安裝完成
    InstallDialog --> InstallCancelled: 取消安裝
    
    InstallComplete --> HidePrompt
    InstallCancelled --> HidePrompt
    DismissClicked --> HidePrompt
    
    HidePrompt --> [*]: 提示隱藏