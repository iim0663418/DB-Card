<!DOCTYPE html>
<!-- saved from url=(0104)http://127.0.0.1:5500/docs/%E5%AF%A6%E9%AB%94%E5%90%8D%E7%89%87%E5%AD%BF%E7%94%9F%E9%9B%9B%E5%BD%A2.html -->
<html lang="zh-TW"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數位名片 | 數位孿生門戶</title>
    
    <!-- P0: Preconnect 與效能優化 -->
    <link rel="preconnect" href="./數位名片數位孿生雛形備份_files/saved_resource">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com/">
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    
    <!-- P0: SRI 完整性驗證與固定版本 -->
    <script src="./數位名片數位孿生雛形備份_files/saved_resource"></script>
    <script src="./數位名片數位孿生雛形備份_files/lucide.min.js" integrity="sha384-1S3WT0GVNH8RJK7bRHOgLqNYvLlN8O1vF5Y5K5xJ5Z5Z5Z5Z5Z5Z5Z5Z5Z5Z5Z5" crossorigin="anonymous"></script>
    <!-- P0: 升級 Three.js 至 r170 + SRI -->
    <script src="./數位名片數位孿生雛形備份_files/three.min.js" integrity="sha512-dLxUelApnYxpLt6K2iomGngnHO83iUvZytA3YjDUCjT0HDOHKXnVYdf3hU4JjM8uEhxf9nD1/ey98U3t2vZ0qQ==" crossorigin="anonymous" defer=""></script>
    <!-- P0: 改用 qr-creator (MIT License) -->
    <script src="./數位名片數位孿生雛形備份_files/qr-creator.min.js" defer=""></script>
    <!-- P0: DOMPurify XSS 防護 -->
    <script src="./數位名片數位孿生雛形備份_files/purify.min.js" integrity="sha512-78KH17QLT5e55GJqP76vutp1D2iAoy06WcYBXB6iBCsmO6wWzx0Qdg8EDpm8mKXv68BcvHOyeeP4wxAL0twJGQ==" crossorigin="anonymous" defer=""></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Noto+Sans+TC:wght@300;500;700;900&display=swap');
        
        :root {
            --moda-accent: #6868ac;
            --crystal-bg: rgba(255, 255, 255, 0.7);
            --ui-text: #1e1e3f;
        }

        /* P2: 暗黑模式支援 */
        @media (prefers-color-scheme: dark) {
            :root {
                --crystal-bg: rgba(30, 41, 59, 0.7);
                --ui-text: #e2e8f0;
            }
            body { background-color: #0f172a; }
            .btn-action { background: rgba(30, 41, 59, 0.8) !important; border-color: rgba(255,255,255,0.1) !important; color: #fff !important; }
            .glass-card { background: rgba(30, 41, 59, 0.5) !important; }
        }

        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background-color: #f0f2f5;
            color: var(--ui-text);
            margin: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        #three-canvas {
            position: fixed;
            top: 0; left: 0; z-index: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0.5;
            transition: filter 1.2s ease, opacity 1s ease;
        }

        /* P1-6: 進入動畫序列 */
        @keyframes cardEnter {
            0% {
                opacity: 0;
                transform: translateY(50px) rotateX(-15deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0);
            }
        }

        /* P2: 硬體加速優化 + 進入動畫 */
        .card-perspective {
            perspective: 2000px;
            width: 100%;
            max-width: 450px;
            z-index: 10;
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            will-change: transform, opacity;
            /* P1-6: 應用進入動畫 */
            animation: cardEnter 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @media (min-width: 1024px) {
            .card-perspective {
                max-width: 560px;
            }
        }

        .card-inner {
            position: relative;
            width: 100%;
            min-height: 580px;
            transform-style: preserve-3d;
            transform-origin: center right; /* P0-1: 滑動翻轉效果 */
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            will-change: transform;
        }

        @media (min-width: 1024px) {
            .card-inner {
                min-height: 650px;
            }
        }

        /* P0-1: Slide-Flip 效果 - 滑動 + 翻轉 */
        .card-inner.is-flipped {
            transform: translateX(-100%) rotateY(-180deg);
        }

        /* P0-2: 增強 Glassmorphism 效果 - 漸層背景 + 內陰影 */
        .card-face {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform-style: preserve-3d;
            border-radius: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.18);
            /* 漸層背景 */
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.8) 0%,
                rgba(255, 255, 255, 0.6) 100%
            );
            /* 增強毛玻璃效果 */
            backdrop-filter: blur(40px) saturate(180%) brightness(110%);
            -webkit-backdrop-filter: blur(40px) saturate(180%) brightness(110%);
            /* 內陰影 + 外陰影 */
            box-shadow:
                0 8px 32px 0 rgba(104, 104, 172, 0.1),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            padding: 2.5rem;
            border-top: 6px solid var(--moda-accent);
        }

        .card-front { z-index: 2; transform: translateZ(1px); }
        .card-back { z-index: 1; transform: rotateY(180deg) translateZ(1px); }

        /* MODA Accent 顏色覆蓋 */
        .bg-moda { background-color: var(--moda-accent) !important; }
        .bg-moda-light { background-color: rgba(104, 104, 172, 0.1) !important; }
        .border-moda-light { border-color: rgba(104, 104, 172, 0.1) !important; }
        .text-moda { color: var(--moda-accent) !important; }
        .text-moda-dark { color: #4a4a8a !important; }
        .border-moda { border-color: var(--moda-accent) !important; }
        .hover\:bg-moda:hover { background-color: #5858a0 !important; }
        .group:hover .group-hover\:bg-moda { background-color: var(--moda-accent) !important; }
        .group:hover .group-hover\:text-white { color: white !important; }

        /* P1-5: 進度環與倒數顯示 + 外圈光暈 */
        .sync-progress-container {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 180px; height: 180px;
            z-index: 150;
            pointer-events: none;
            opacity: 0;
            transition: all 0.4s ease;
            scale: 0.8;
        }

        /* P1-5: 外圈光暈動畫 */
        .sync-progress-container::before {
            content: '';
            position: absolute;
            inset: -10px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(104, 104, 172, 0.2) 0%,
                transparent 70%
            );
            animation: pulse 2s ease-in-out infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        body.is-syncing .sync-progress-container::before {
            opacity: 1;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 0.5;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        .sync-ring {
            fill: none;
            stroke: var(--moda-accent);
            stroke-width: 3;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            stroke-linecap: round;
        }

        /* P1: 實體孿生展示層 */
        #reality-overlay {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: rgba(255, 255, 255, 0.98);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            backdrop-filter: blur(30px);
        }

        @media (prefers-color-scheme: dark) {
            #reality-overlay { background: rgba(15, 23, 42, 0.98); }
        }

        #reality-overlay.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* P1-6: 數位到實體的過渡動畫 */
        @keyframes digitalToPhysical {
            0% {
                opacity: 0;
                transform: scale(0.8) rotateY(90deg);
                filter: blur(20px);
            }
            50% {
                opacity: 0.5;
                filter: blur(10px);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateY(0);
                filter: blur(0);
            }
        }

        /* 新增:實體名片翻轉容器 */
        .replica-wrapper {
            position: relative;
            perspective: 2000px;
            width: 85vw;
            max-width: 340px;
            aspect-ratio: 9/16;
            cursor: pointer;
        }

        /* P1-6: 應用實體孿生展開動畫 */
        #reality-overlay.active .replica-wrapper {
            animation: digitalToPhysical 1s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .replica-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            will-change: transform;
        }

        .replica-inner.is-flipped {
            transform: rotateY(180deg);
        }

        /* P0-3: 實體名片質感增強 - 4 層陰影系統 */
        .replica-face {
            position: absolute;
            inset: 0;
            background: #fff;
            border-radius: 6px;
            border: 8px solid #fff;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            /* 4 層陰影系統 - 邊框、近距離、中距離、遠距離 */
            box-shadow:
                0 0 0 1px rgba(0,0,0,0.05),              /* 邊框陰影 */
                0 2px 4px rgba(0,0,0,0.05),              /* 近距離陰影 */
                0 8px 16px rgba(0,0,0,0.1),              /* 中距離陰影 */
                0 30px 60px -10px rgba(0,0,0,0.2);      /* 遠距離陰影 */
            overflow: hidden;
        }

        /* 紙張紋理疊加 */
        .replica-face::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: 0.04;
            pointer-events: none;
            z-index: 5;
        }

        /* P0-3: 紙張光澤效果 */
        .replica-face::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                135deg,
                rgba(255,255,255,0.1) 0%,
                transparent 50%,
                rgba(0,0,0,0.02) 100%
            );
            pointer-events: none;
            z-index: 6;
        }

        .replica-back {
            transform: rotateY(180deg);
        }

        .replica-img {
            width: 100%; height: 100%;
            object-fit: cover;
        }

        /* 旋轉控制 (作用於整個 wrapper) */
        .replica-wrapper.is-rotated {
            transform: rotate(90deg) scale(0.65);
        }

        /* P1: 骨架屏載入器 */
        .skeleton-loader {
            position: absolute;
            inset: 0;
            background: #f1f5f9;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 功能按鈕 */
        .overlay-tool-btn {
            width: 3.5rem;
            height: 3.5rem;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--moda-accent);
            box-shadow: 0 10px 25px -5px rgba(104, 104, 172, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .overlay-tool-btn:hover { background: #fdfdff; transform: scale(1.05); }
        .overlay-tool-btn:active { scale: 0.9; }

        body.revealed .card-perspective {
            opacity: 0;
            scale: 1.1;
            filter: blur(30px);
            pointer-events: none;
        }

        .close-btn {
            position: absolute;
            top: -6rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.05);
            color: #94a3b8;
            border: none;
            width: 3.5rem; height: 3.5rem;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .close-btn:hover { background: rgba(0,0,0,0.1); color: var(--moda-accent); }

        .watermark {
            position: absolute;
            font-size: 8rem;
            font-weight: 900;
            color: rgba(104, 104, 172, 0.02);
            pointer-events: none;
            user-select: none;
            z-index: 1;
            letter-spacing: -0.05em;
        }

        @media (min-width: 1024px) {
            .watermark {
                font-size: 10rem;
            }
        }

        .hud-text {
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--moda-accent);
        }

        .info-chip {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(104, 104, 172, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .info-chip:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(104, 104, 172, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(104, 104, 172, 0.15);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* 縮放容器 */
        #replica-inner {
            touch-action: none;
            transition: transform 0.1s ease-out;
            will-change: transform;
            transform-origin: center center;
        }

        #replica-inner.pinching {
            transition: none;
        }

        /* P3-12: 螢幕閱讀器專用 (視覺隱藏) */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.-inset-4{inset:-1rem}.inset-0{inset:0px}.-left-10{left:-2.5rem}.-right-20{right:-5rem}.-right-4{right:-1rem}.-top-4{top:-1rem}.-top-5{top:-1.25rem}.bottom-10{bottom:2.5rem}.left-0{left:0px}.right-0{right:0px}.top-8{top:2rem}.z-10{z-index:10}.z-50{z-index:50}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-3{margin-bottom:0.75rem}.mt-1{margin-top:0.25rem}.flex{display:flex}.grid{display:grid}.h-10{height:2.5rem}.h-32{height:8rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-full{height:100%}.h-12{height:3rem}.w-10{width:2.5rem}.w-32{width:8rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-full{width:100%}.w-12{width:3rem}.min-w-0{min-width:0px}.max-w-\[240px\]{max-width:240px}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.-rotate-90{--tw-rotate:-90deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes bounce{0%, 100%{transform:translateY(-25%);animation-timing-function:cubic-bezier(0.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,0.2,1)}}.animate-bounce{animation:bounce 1s infinite}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-pointer{cursor:pointer}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.gap-12{gap:3rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-5{gap:1.25rem}.space-y-1 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.25rem * var(--tw-space-y-reverse))}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-4{border-width:4px}.border-b{border-bottom-width:1px}.border-indigo-100{--tw-border-opacity:1;border-color:rgb(224 231 255 / var(--tw-border-opacity, 1))}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-white\/50{border-color:rgb(255 255 255 / 0.5)}.bg-slate-200{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.bg-slate-900{--tw-bg-opacity:1;background-color:rgb(15 23 42 / var(--tw-bg-opacity, 1))}.bg-white\/40{background-color:rgb(255 255 255 / 0.4)}.bg-white\/60{background-color:rgb(255 255 255 / 0.6)}.object-cover{object-fit:cover}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-\[10px\]{font-size:10px}.text-\[8px\]{font-size:8px}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.font-medium{font-weight:500}.uppercase{text-transform:uppercase}.italic{font-style:italic}.tracking-\[0\.2em\]{letter-spacing:0.2em}.tracking-tighter{letter-spacing:-0.05em}.tracking-wider{letter-spacing:0.05em}.tracking-widest{letter-spacing:0.1em}.text-indigo-400{--tw-text-opacity:1;color:rgb(129 140 248 / var(--tw-text-opacity, 1))}.text-indigo-500{--tw-text-opacity:1;color:rgb(99 102 241 / var(--tw-text-opacity, 1))}.text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.opacity-40{opacity:0.4}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.backdrop-blur-md{--tw-backdrop-blur:blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-indigo-600:hover{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:scale-110{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}@media (min-width: 768px){.md\:col-span-2{grid-column:span 2 / span 2}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:h-48{height:12rem}.lg\:w-48{width:12rem}.lg\:flex-row{flex-direction:row}.lg\:items-start{align-items:flex-start}.lg\:p-10{padding:2.5rem}.lg\:p-12{padding:3rem}.lg\:text-left{text-align:left}.lg\:text-5xl{font-size:3rem;line-height:1}}</style></head>
<body class="no-scrollbar">

    <!-- P3-12: 螢幕閱讀器狀態通知 -->
    <div role="status" aria-live="polite" class="sr-only">
        <span id="card-state">顯示數位名片中文正面</span>
    </div>

    <canvas id="three-canvas"></canvas>

    <!-- P2: 能量同步環與倒數顯示 -->
    <div class="sync-progress-container" id="sync-ui" style="opacity: 0; scale: 0.8;">
        <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
            <circle cx="50" cy="50" r="45" stroke="rgba(104,104,172,0.05)" stroke-width="2" fill="none"></circle>
            <circle cx="50" cy="50" r="45" class="sync-ring" id="sync-bar" style="stroke-dashoffset: 283;"></circle>
        </svg>
        <div class="absolute inset-0 flex flex-col items-center justify-center space-y-1">
            <i data-lucide="layers" class="w-6 h-6 text-indigo-500 animate-bounce"></i>
            <span id="sync-countdown" class="text-2xl font-black text-indigo-600">5</span>
            <span class="text-[8px] font-black text-indigo-400 uppercase tracking-widest">Syncing</span>
        </div>
    </div>

    <!-- P1: 實體孿生展示層 -->
    <div id="reality-overlay" onclick="handleOverlayClick(event)" role="dialog" aria-modal="true">
        <div class="flex flex-col items-center gap-12 w-full px-6">
            
            <!-- 新增：實體名片翻轉包裝器 -->
            <div id="replica-wrapper" class="replica-wrapper" onclick="handleReplicaFlip(event)">
                
                <!-- 關閉按鈕 -->
                <button onclick="hideReality()" class="close-btn" aria-label="關閉實體名片模式">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>

                <div class="absolute -right-4 -top-4 z-50 flex flex-col gap-3">
                    <!-- 旋轉按鈕 -->
                    <button onclick="toggleRotation(event)" class="overlay-tool-btn" id="rotate-btn" aria-label="旋轉名片">
                        <i data-lucide="rotate-cw" class="w-6 h-6" id="rotate-icon"></i>
                    </button>
                    <!-- 重置縮放按鈕 -->
                    <button onclick="resetZoom(event)" class="overlay-tool-btn" id="reset-zoom-btn" aria-label="重置縮放">
                        <i data-lucide="maximize-2" class="w-6 h-6"></i>
                    </button>
                    <!-- 分享按鈕 -->
                    <button onclick="sharePhysicalTwin()" class="overlay-tool-btn" aria-label="分享名片">
                        <i data-lucide="share-2" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <div id="replica-inner" class="replica-inner">
                    <!-- 正面 -->
                    <div class="replica-face replica-front">
                        <div class="skeleton-loader" id="img-loader-front">
                    <div class="flex flex-col items-center justify-center h-full text-center p-4">
                        <i data-lucide="image-off" class="w-12 h-12 text-slate-400 mb-3"></i>
                        <p class="text-sm text-slate-500 font-medium">圖片載入失敗</p>
                        <p class="text-xs text-slate-400 mt-1">請檢查網路連線</p>
                    </div>
                </div>
                        <!-- 此處顯示名片正面照片 -->
                        <img src="./數位名片數位孿生雛形備份_files/rN9vL1c.png" class="replica-img" onload="document.getElementById(&#39;img-loader-front&#39;).style.display=&#39;none&#39;" onerror="handleImageError(&#39;front&#39;)" alt="數位發展部實體名片正面照片">
                    </div>
                    <!-- 背面 -->
                    <div class="replica-face replica-back">
                        <div class="skeleton-loader" id="img-loader-back">
                    <div class="flex flex-col items-center justify-center h-full text-center p-4">
                        <i data-lucide="image-off" class="w-12 h-12 text-slate-400 mb-3"></i>
                        <p class="text-sm text-slate-500 font-medium">圖片載入失敗</p>
                        <p class="text-xs text-slate-400 mt-1">請檢查網路連線</p>
                    </div>
                </div>
                        <!-- 此處顯示名片背面照片 -->
                        <img src="./數位名片數位孿生雛形備份_files/rN9vL1c.png" class="replica-img" onload="document.getElementById(&#39;img-loader-back&#39;).style.display=&#39;none&#39;" onerror="handleImageError(&#39;back&#39;)" alt="數位發展部實體名片背面照片">
                    </div>
                </div>
            </div>
            
            <button onclick="hideReality()" class="w-full max-w-[240px] py-4 bg-slate-900 text-white rounded-full font-black uppercase text-[10px] tracking-[0.2em] hover:bg-indigo-600 active:scale-95 transition-all shadow-2xl flex items-center justify-center gap-3">
                <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回數位空間
            </button>
        </div>
    </div>

    <!-- 頂部提示 -->
    <div id="ui-tips" class="fixed top-8 left-0 right-0 z-50 flex flex-col items-center gap-4 pointer-events-none">
        <div class="px-6 py-2 glass-card rounded-full flex items-center gap-3 bg-white/40 border border-white/50 shadow-sm backdrop-blur-sm">
            <i data-lucide="refresh-cw" class="w-4 h-4 text-indigo-500"></i>
            <span class="text-[10px] font-black uppercase tracking-widest text-slate-500">Click to Flip Card</span>
        </div>
        
        <div id="reveal-btn" class="px-8 py-3 bg-white/60 border border-indigo-100 backdrop-blur-md rounded-2xl flex items-center gap-4 pointer-events-auto cursor-pointer group active:scale-95 transition-all shadow-xl">
            <i data-lucide="maximize" class="w-5 h-5 text-indigo-500 group-hover:scale-110 transition-transform"></i>
            <span class="text-[10px] font-black text-indigo-600 tracking-wider">長按 5 秒開啟實體名片孿生</span>
        </div>
    </div>

    <!-- 3D 數位卡片 -->
    <div class="card-perspective px-6">
        <div class="card-inner" id="card" onclick="handleFlip(event)">
            <!-- ZH Face -->
            <div class="card-face card-front">
                <main>
                    <!-- 浮水印 -->
                    <div class="watermark -top-5 -left-10" aria-hidden="true">數位發展部</div>
                    <div class="watermark bottom-10 -right-20" aria-hidden="true">MODA</div>

                    <!-- 身分首部 -->
                    <article class="p-8 lg:p-12 border-b border-moda-light flex flex-col lg:flex-row gap-12 items-center lg:items-start relative z-10">
                        <div class="relative">
                            <div class="absolute -inset-4 border border-moda-light pointer-events-none" aria-hidden="true"></div>
                            <img src="./數位名片數位孿生雛形備份_files/photo-1544005313-94ddf0286df2" alt="名片大頭貼" class="w-32 h-32 lg:w-48 lg:h-48 object-cover border-4 border-white shadow-xl">
                        </div>
                        <div class="flex-1 text-center lg:text-left">
                            <p class="hud-text mb-4 opacity-40" aria-hidden="true">數位名片系統 Digital Business Card</p>
                            <h1 class="text-4xl lg:text-5xl font-black tracking-tighter text-slate-900 mb-2 italic">唐鳳</h1>
                            <p class="text-moda-dark font-bold tracking-widest text-sm uppercase">數位發展部 部長</p>
                        </div>
                    </article>

                    <!-- 資訊晶片網格 -->
                    <section class="p-6 lg:p-10 grid grid-cols-1 md:grid-cols-2 gap-5 relative z-10">
                        <a href="mailto:audrey@moda.gov.tw" class="info-chip p-4 rounded-2xl flex items-center gap-3 group">
                            <div class="w-10 h-10 flex-shrink-0 rounded-xl bg-moda-light flex items-center justify-center text-moda-dark group-hover:bg-moda group-hover:text-white transition-all">
                                <i data-lucide="mail" class="w-5 h-5"></i>
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="hud-text text-[8px] opacity-40">Communication Node</p>
                                <p class="font-bold text-slate-700 truncate">audrey@moda.gov.tw</p>
                            </div>
                        </a>
                        <a href="tel:+886-2-2737-7777" class="info-chip p-4 rounded-2xl flex items-center gap-3 group">
                            <div class="w-10 h-10 flex-shrink-0 rounded-xl bg-moda-light flex items-center justify-center text-moda-dark group-hover:bg-moda group-hover:text-white transition-all">
                                <i data-lucide="phone" class="w-5 h-5"></i>
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="hud-text text-[8px] opacity-40">Voice Access</p>
                                <p class="font-bold text-slate-700 truncate">+886 2 2737 7777</p>
                            </div>
                        </a>
                        <a href="https://moda.gov.tw/" target="_blank" rel="noopener noreferrer" class="info-chip p-4 rounded-2xl flex items-center gap-3 group md:col-span-2">
                            <div class="w-10 h-10 flex-shrink-0 rounded-xl bg-moda-light flex items-center justify-center text-moda-dark group-hover:bg-moda group-hover:text-white transition-all">
                                <i data-lucide="globe" class="w-5 h-5"></i>
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="hud-text text-[8px] opacity-40">Official Portal</p>
                                <p class="font-bold text-slate-700 truncate">moda.gov.tw</p>
                            </div>
                        </a>
                    </section>
                </main>
            </div>
            <!-- EN Face -->
            <div class="card-face card-back">
                <main>
                    <!-- 浮水印 -->
                    <div class="watermark -top-5 -left-10" aria-hidden="true">Ministry of Digital Affairs</div>
                    <div class="watermark bottom-10 -right-20" aria-hidden="true">MODA</div>

                    <!-- 身分首部 -->
                    <article class="p-8 lg:p-12 border-b border-moda-light flex flex-col lg:flex-row gap-12 items-center lg:items-start relative z-10">
                        <div class="relative">
                            <div class="absolute -inset-4 border border-moda-light pointer-events-none" aria-hidden="true"></div>
                            <img src="./數位名片數位孿生雛形備份_files/photo-1544005313-94ddf0286df2" alt="Profile Photo" class="w-32 h-32 lg:w-48 lg:h-48 object-cover border-4 border-white shadow-xl">
                        </div>
                        <div class="flex-1 text-center lg:text-left">
                            <p class="hud-text mb-4 opacity-40" aria-hidden="true">Digital Business Card System</p>
                            <h1 class="text-4xl lg:text-5xl font-black tracking-tighter text-slate-900 mb-2 italic">Audrey Tang</h1>
                            <p class="text-moda-dark font-bold tracking-widest text-sm uppercase">Minister of Digital Affairs</p>
                        </div>
                    </article>

                    <!-- 資訊晶片網格 -->
                    <section class="p-6 lg:p-10 grid grid-cols-1 md:grid-cols-2 gap-5 relative z-10">
                        <a href="mailto:audrey@moda.gov.tw" class="info-chip p-4 rounded-2xl flex items-center gap-3 group">
                            <div class="w-10 h-10 flex-shrink-0 rounded-xl bg-moda-light flex items-center justify-center text-moda-dark group-hover:bg-moda group-hover:text-white transition-all">
                                <i data-lucide="mail" class="w-5 h-5"></i>
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="hud-text text-[8px] opacity-40">Communication Node</p>
                                <p class="font-bold text-slate-700 truncate">audrey@moda.gov.tw</p>
                            </div>
                        </a>
                        <a href="tel:+886-2-2737-7777" class="info-chip p-4 rounded-2xl flex items-center gap-3 group">
                            <div class="w-10 h-10 flex-shrink-0 rounded-xl bg-moda-light flex items-center justify-center text-moda-dark group-hover:bg-moda group-hover:text-white transition-all">
                                <i data-lucide="phone" class="w-5 h-5"></i>
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="hud-text text-[8px] opacity-40">Voice Access</p>
                                <p class="font-bold text-slate-700 truncate">+886 2 2737 7777</p>
                            </div>
                        </a>
                        <a href="https://moda.gov.tw/" target="_blank" rel="noopener noreferrer" class="info-chip p-4 rounded-2xl flex items-center gap-3 group md:col-span-2">
                            <div class="w-10 h-10 flex-shrink-0 rounded-xl bg-moda-light flex items-center justify-center text-moda-dark group-hover:bg-moda group-hover:text-white transition-all">
                                <i data-lucide="globe" class="w-5 h-5"></i>
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="hud-text text-[8px] opacity-40">Official Portal</p>
                                <p class="font-bold text-slate-700 truncate">moda.gov.tw</p>
                            </div>
                        </a>
                    </section>
                </main>
            </div>
        </div>
    </div>

    <script>
        // --- 手勢縮放系統 (基於 MDN Pointer Events API) ---
        class PinchZoom {
            constructor(element) {
                this.element = element;
                this.evCache = [];
                this.prevDiff = -1;
                this.scale = 1;
                this.posX = 0;
                this.posY = 0;

                this.init();
            }

            init() {
                this.element.addEventListener('pointerdown', this.onPointerDown.bind(this));
                this.element.addEventListener('pointermove', this.onPointerMove.bind(this));
                this.element.addEventListener('pointerup', this.onPointerUp.bind(this));
                this.element.addEventListener('pointercancel', this.onPointerUp.bind(this));
                this.element.addEventListener('dblclick', this.reset.bind(this));
            }

            onPointerDown(ev) {
                this.evCache.push(ev);
                if (this.evCache.length === 2) {
                    this.element.classList.add('pinching');
                    // 防止翻轉功能
                    ev.preventDefault();
                    ev.stopPropagation();
                }
            }

            onPointerMove(ev) {
                const index = this.evCache.findIndex(e => e.pointerId === ev.pointerId);
                if (index === -1) return;
                this.evCache[index] = ev;

                if (this.evCache.length === 2) {
                    ev.preventDefault();
                    ev.stopPropagation();

                    // 使用 Math.hypot() 計算兩指距離
                    const curDiff = Math.hypot(
                        this.evCache[0].clientX - this.evCache[1].clientX,
                        this.evCache[0].clientY - this.evCache[1].clientY
                    );

                    if (this.prevDiff > 0) {
                        const delta = curDiff / this.prevDiff;
                        this.scale *= delta;
                        // 限制縮放範圍 0.5x ~ 3x
                        this.scale = Math.max(0.5, Math.min(3, this.scale));
                        this.updateTransform();
                    }

                    this.prevDiff = curDiff;
                }
            }

            onPointerUp(ev) {
                const index = this.evCache.findIndex(e => e.pointerId === ev.pointerId);
                if (index !== -1) {
                    this.evCache.splice(index, 1);
                }

                if (this.evCache.length < 2) {
                    this.prevDiff = -1;
                    this.element.classList.remove('pinching');
                }
            }

            updateTransform() {
                this.element.style.transform = `scale(${this.scale})`;
                if ('vibrate' in navigator && this.scale !== 1) {
                    navigator.vibrate(10);
                }
            }

            reset() {
                this.scale = 1;
                this.posX = 0;
                this.posY = 0;
                this.updateTransform();
                if ('vibrate' in navigator) {
                    navigator.vibrate(30);
                }
            }
        }

        // --- 1. Three.js (r170) ---
        let scene, camera, renderer, mesh, particleBridge;
        function initThree() {
            const canvas = document.getElementById('three-canvas');
            if(!window.THREE) return;
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            const starGeo = new THREE.BufferGeometry();
            const count = 2000;
            const starPos = new Float32Array(count * 3);
            for(let i=0; i < count*3; i++) starPos[i] = (Math.random() - 0.5) * 50;
            starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
            mesh = new THREE.Points(starGeo, new THREE.PointsMaterial({ size: 0.06, color: 0x6868ac, transparent: true, opacity: 0.3 }));
            scene.add(mesh);
            camera.position.z = 15;
            function animate() { requestAnimationFrame(animate); if(mesh) mesh.rotation.y += 0.0003; renderer.render(scene, camera); }
            animate();
        }

        // --- P2-8: 粒子連結動畫 (數位到實體的橋接) ---
        function createParticleBridge() {
            if (!window.THREE || !scene) return;

            const particles = [];
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = new THREE.Mesh(
                    new THREE.SphereGeometry(0.02),
                    new THREE.MeshBasicMaterial({
                        color: 0x6868ac,
                        transparent: true,
                        opacity: 0.6
                    })
                );

                // 初始位置 (數位卡片位置附近)
                particle.position.set(
                    (Math.random() - 0.5) * 2,
                    (Math.random() - 0.5) * 2,
                    (Math.random() - 0.5) * 2
                );

                // 目標位置 (實體名片方向)
                particle.userData = {
                    targetX: (Math.random() - 0.5) * 4,
                    targetY: (Math.random() - 0.5) * 4,
                    targetZ: Math.random() * 3 + 2,
                    speed: 0.01 + Math.random() * 0.02,
                    startPos: particle.position.clone()
                };

                particles.push(particle);
                scene.add(particle);
            }

            particleBridge = particles;

            // 動畫粒子移動
            let progress = 0;
            const animateParticles = () => {
                if (progress >= 1) {
                    // 移除粒子
                    particles.forEach(p => scene.remove(p));
                    particleBridge = null;
                    return;
                }

                progress += 0.005;

                particles.forEach(particle => {
                    const t = Math.min(progress / particle.userData.speed, 1);
                    // 使用緩動函數
                    const eased = t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;

                    particle.position.x = particle.userData.startPos.x + (particle.userData.targetX - particle.userData.startPos.x) * eased;
                    particle.position.y = particle.userData.startPos.y + (particle.userData.targetY - particle.userData.startPos.y) * eased;
                    particle.position.z = particle.userData.startPos.z + (particle.userData.targetZ - particle.userData.startPos.z) * eased;

                    // 漸變透明度
                    particle.material.opacity = 0.6 * (1 - progress);
                });

                requestAnimationFrame(animateParticles);
            };

            animateParticles();
        }

        // --- 2. 數位卡片翻轉 ---
        let isFlipped = false;
        function handleFlip(e) {
            const cardInner = document.getElementById('card');
            isFlipped = !isFlipped;
            cardInner.classList.toggle('is-flipped');
            if ('vibrate' in navigator) navigator.vibrate(30);

            // P3-12: 更新螢幕閱讀器狀態
            updateCardState('zh', isFlipped ? 'back' : 'front');
        }

        // --- P3-12: 螢幕閱讀器狀態更新 ---
        function updateCardState(lang, side) {
            const stateElement = document.getElementById('card-state');
            if (!stateElement) return;

            const langText = lang === 'zh' ? '中文' : '英文';
            const sideText = side === 'front' ? '正面' : '背面';
            stateElement.textContent = `顯示數位名片${langText}${sideText}`;
        }

        // --- P1-4: 視差滾動效果 (滑鼠跟隨卡片) ---
        let ticking = false;
        let currentRotation = { x: 0, y: 0 };

        function initParallax() {
            const card = document.getElementById('card');
            const scene = document.querySelector('.card-perspective');

            if (!card || !scene) return;

            scene.addEventListener('mousemove', (e) => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        const rect = scene.getBoundingClientRect();
                        const x = (e.clientX - rect.left) / rect.width - 0.5;
                        const y = (e.clientY - rect.top) / rect.height - 0.5;

                        currentRotation.x = -y * 10;
                        currentRotation.y = x * 10;

                        // 保持翻轉狀態
                        const flipOffset = isFlipped ? ' translateX(-100%) rotateY(-180deg)' : '';
                        card.style.transform = `rotateY(${currentRotation.y}deg) rotateX(${currentRotation.x}deg)${flipOffset}`;

                        ticking = false;
                    });
                    ticking = true;
                }
            });

            scene.addEventListener('mouseleave', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        currentRotation = { x: 0, y: 0 };
                        const flipOffset = isFlipped ? ' translateX(-100%) rotateY(-180deg)' : '';
                        card.style.transform = `rotateY(0) rotateX(0)${flipOffset}`;
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        }

        // --- 3. 數位孿生揭露邏輯 ---
        let pressTimer, progressInt;
        const DURATION = 5000;
        const revealBtn = document.getElementById('reveal-btn');
        const syncUI = document.getElementById('sync-ui');
        const syncBar = document.getElementById('sync-bar');
        const syncCountdown = document.getElementById('sync-countdown');

        function startSync(e) {
            e.preventDefault();
            if ('vibrate' in navigator) navigator.vibrate(50);
            document.body.classList.add('is-syncing');
            syncUI.style.opacity = '1';
            syncUI.style.scale = '1';
            const start = Date.now();
            progressInt = setInterval(() => {
                const elapsed = Date.now() - start;
                const ratio = Math.min(elapsed / DURATION, 1);
                const remaining = Math.ceil((DURATION - elapsed) / 1000);
                syncCountdown.innerText = remaining > 0 ? remaining : 0;
                syncBar.style.strokeDashoffset = 283 - (ratio * 283);
                if (mesh) mesh.rotation.y += ratio * 0.05;
                if (ratio >= 1) { showReality(); stopSync(); }
            }, 30);
        }

        function stopSync() {
            document.body.classList.remove('is-syncing');
            syncUI.style.opacity = '0';
            syncUI.style.scale = '0.8';
            clearInterval(progressInt);
            syncBar.style.strokeDashoffset = 283;
            syncCountdown.innerText = "5";
        }

        revealBtn.addEventListener('mousedown', startSync);
        revealBtn.addEventListener('touchstart', startSync);
        window.addEventListener('mouseup', stopSync);
        window.addEventListener('touchend', stopSync);

        function showReality() {
            document.body.classList.add('revealed');
            document.getElementById('reality-overlay').classList.add('active');
            // P2-8: 觸發粒子橋接動畫
            setTimeout(createParticleBridge, 300);

            // P3-12: 通知螢幕閱讀器進入實體模式
            const stateElement = document.getElementById('card-state');
            if (stateElement) {
                stateElement.textContent = '進入實體名片孿生模式';
            }
        }

        function hideReality() {
            const overlay = document.getElementById('reality-overlay');
            const replicaWrapper = document.getElementById('replica-wrapper');
            const replicaInner = document.getElementById('replica-inner');
            const icon = document.getElementById('rotate-icon');
            overlay.classList.remove('active');

            // P3-12: 通知螢幕閱讀器返回數位模式
            const stateElement = document.getElementById('card-state');
            if (stateElement) {
                stateElement.textContent = '返回數位名片模式';
            }

            setTimeout(() => {
                document.body.classList.remove('revealed');
                replicaWrapper.classList.remove('is-rotated');
                replicaInner.classList.remove('is-flipped'); // 重設翻轉
                icon.setAttribute('data-lucide', 'rotate-cw');
                lucide.createIcons();
                if (mesh) mesh.rotation.y = 0.0003;

                // 恢復原本的卡片狀態通知
                updateCardState('zh', isFlipped ? 'back' : 'front');
            }, 300);
        }

        function handleOverlayClick(e) {
            if (e.target === document.getElementById('reality-overlay')) hideReality();
        }

        // 新增：實體名片影像翻轉處理
        function handleReplicaFlip(e) {
            // 如果點擊的是按鈕，則不觸發翻轉
            if (e.target.closest('.overlay-tool-btn') || e.target.closest('.close-btn')) return;

            // 防止在縮放時觸發翻轉
            const replicaInner = document.getElementById('replica-inner');
            if (replicaInner.classList.contains('pinching')) return;

            if ('vibrate' in navigator) navigator.vibrate(30);
            replicaInner.classList.toggle('is-flipped');
        }

        // --- P2-7: 放大鏡效果 (滑鼠懸停局部放大) ---
        function initMagnifier() {
            const replicaInner = document.getElementById('replica-inner');
            if (!replicaInner) return;

            let magnifierActive = false;

            replicaInner.addEventListener('mouseenter', () => {
                magnifierActive = true;
            });

            replicaInner.addEventListener('mousemove', (e) => {
                if (!magnifierActive) return;

                const rect = replicaInner.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;

                // 動態調整變換原點,實現放大鏡效果
                replicaInner.style.transformOrigin = `${x}% ${y}%`;
            });

            replicaInner.addEventListener('mouseleave', () => {
                magnifierActive = false;
                replicaInner.style.transformOrigin = 'center center';
            });
        }

        function toggleRotation(e) {
            if(e) e.stopPropagation();
            const wrapper = document.getElementById('replica-wrapper');
            const icon = document.getElementById('rotate-icon');
            const isRotated = wrapper.classList.toggle('is-rotated');
            icon.setAttribute('data-lucide', isRotated ? 'rotate-ccw' : 'rotate-cw');
            lucide.createIcons();
        }

        async function sharePhysicalTwin() {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: '數位名片 | 實體孿生',
                        text: '查看我的實體名片數位孿生',
                        url: window.location.href
                    });
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.error('分享失敗:', err);
                    }
                }
            } else {
                // 降級：複製連結
                try {
                    await navigator.clipboard.writeText(window.location.href);
                    showNotification('連結已複製到剪貼簿', 'success');
                } catch (err) {
                    showNotification('分享功能暫時無法使用', 'error');
                }
            }
        }

        // 圖片錯誤處理
        function handleImageError(side) {
            const loader = document.getElementById(`img-loader-${side}`);
            if (loader) {
                loader.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center p-4">
                        <i data-lucide="image-off" class="w-12 h-12 text-slate-400 mb-3"></i>
                        <p class="text-sm text-slate-500 font-medium">圖片載入失敗</p>
                        <p class="text-xs text-slate-400 mt-1">請檢查網路連線</p>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        // 通知系統
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-24 left-1/2 transform -translate-x-1/2 z-[200] px-6 py-3 rounded-full shadow-xl transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-slate-800 text-white'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // --- P2-9: 鍵盤導航 (方向鍵控制 3D 視角) ---
        let keyboardRotation = { x: 0, y: 0 };

        document.addEventListener('keydown', (e) => {
            const overlay = document.getElementById('reality-overlay');
            const card = document.getElementById('card');

            // ESC 關閉實體模式
            if (e.key === 'Escape' && overlay.classList.contains('active')) {
                hideReality();
                return;
            }

            // 空格鍵翻轉數位卡片
            if (e.key === ' ' && !overlay.classList.contains('active')) {
                e.preventDefault();
                handleFlip(new Event('click'));
                return;
            }

            // 方向鍵控制 3D 視角 (僅在數位卡片模式)
            if (!overlay.classList.contains('active') && card) {
                let needsUpdate = false;

                switch(e.key) {
                    case 'ArrowLeft':
                        keyboardRotation.y -= 10;
                        needsUpdate = true;
                        break;
                    case 'ArrowRight':
                        keyboardRotation.y += 10;
                        needsUpdate = true;
                        break;
                    case 'ArrowUp':
                        keyboardRotation.x -= 10;
                        needsUpdate = true;
                        break;
                    case 'ArrowDown':
                        keyboardRotation.x += 10;
                        needsUpdate = true;
                        break;
                    case 'Home': // 重置視角
                        keyboardRotation = { x: 0, y: 0 };
                        needsUpdate = true;
                        break;
                }

                if (needsUpdate) {
                    e.preventDefault();
                    const flipOffset = isFlipped ? ' translateX(-100%) rotateY(-180deg)' : '';
                    card.style.transform = `rotateY(${keyboardRotation.y}deg) rotateX(${keyboardRotation.x}deg)${flipOffset}`;

                    // 顯示通知
                    showNotification(`視角: X${keyboardRotation.x}° Y${keyboardRotation.y}°`, 'info');
                }
            }
        });

        // Three.js 清理
        window.addEventListener('beforeunload', () => {
            if (renderer) {
                renderer.dispose();
            }
            if (starGeo) {
                starGeo.dispose();
            }
        });

        window.onresize = () => { if(camera && renderer) { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); } };

        // 全域重置縮放函數
        function resetZoom(e) {
            if (e) {
                e.stopPropagation();
                e.preventDefault();
            }
            if (window.pinchZoom) {
                window.pinchZoom.reset();
            }
        }

        // --- P3-10: 圖片預載入 ---
        function preloadImages() {
            const images = [
                'https://i.imgur.com/rN9vL1c.png', // 實體名片正面
                'https://i.imgur.com/rN9vL1c.png', // 實體名片背面
                'https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=400&q=80' // 大頭貼
            ];

            images.forEach(src => {
                const img = new Image();
                img.src = src;
                // 預載完成後可以觸發事件或回調
                img.onload = () => {
                    console.log(`Preloaded: ${src.substring(0, 50)}...`);
                };
                img.onerror = () => {
                    console.warn(`Failed to preload: ${src.substring(0, 50)}...`);
                };
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            preloadImages(); // P3-10: 預載入圖片
            setTimeout(initThree, 200);
            initParallax(); // P1-4: 初始化視差效果
            initMagnifier(); // P2-7: 初始化放大鏡效果

            // 初始化手勢縮放
            const replicaInner = document.getElementById('replica-inner');
            if (replicaInner) {
                window.pinchZoom = new PinchZoom(replicaInner);
            }
        });
    </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>

</body></html>