<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile PWA RWD å„ªåŒ–æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .test-item {
            background: rgba(255, 255, 255, 0.2);
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .test-item.warning {
            border-left-color: #FF9800;
        }
        
        .test-item.error {
            border-left-color: #F44336;
        }
        
        .status {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            -webkit-tap-highlight-color: rgba(76, 175, 80, 0.3);
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-1px);
        }
        
        .safe-area-test {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(255, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: env(safe-area-inset-top);
            z-index: 1000;
        }
        
        @supports (-webkit-appearance: none) {
            .safari-specific {
                display: block;
            }
        }
        
        .safari-specific {
            display: none;
        }
    </style>
</head>
<body>
    <div class="safe-area-test">
        å®‰å…¨å€åŸŸæ¸¬è©¦ (Safe Area Test)
    </div>
    
    <div class="test-container" style="margin-top: 70px;">
        <h1>ğŸ§ª Mobile PWA RWD å„ªåŒ–æ¸¬è©¦</h1>
        
        <div id="browser-info" class="test-item">
            <div class="status">ç€è¦½å™¨æª¢æ¸¬:</div>
            <div id="browser-details">æª¢æ¸¬ä¸­...</div>
        </div>
        
        <div id="viewport-info" class="test-item">
            <div class="status">è¦–çª—è³‡è¨Š:</div>
            <div id="viewport-details">æª¢æ¸¬ä¸­...</div>
        </div>
        
        <div id="pwa-info" class="test-item">
            <div class="status">PWA ç‹€æ…‹:</div>
            <div id="pwa-details">æª¢æ¸¬ä¸­...</div>
        </div>
        
        <div id="safe-area-info" class="test-item">
            <div class="status">å®‰å…¨å€åŸŸ:</div>
            <div id="safe-area-details">æª¢æ¸¬ä¸­...</div>
        </div>
        
        <div class="safari-specific test-item">
            <div class="status">âœ… Safari ç‰¹å®šæ¨£å¼:</div>
            <div>Safari ç‰¹å®š CSS å·²è¼‰å…¥</div>
        </div>
        
        <div class="test-item">
            <div class="status">è§¸æ§æ¸¬è©¦:</div>
            <button class="btn" onclick="testTouch()">é»æ“Šæ¸¬è©¦</button>
            <button class="btn" onclick="testVibration()">éœ‡å‹•æ¸¬è©¦</button>
            <div id="touch-result"></div>
        </div>
        
        <div class="test-item">
            <div class="status">æ–¹å‘æ¸¬è©¦:</div>
            <button class="btn" onclick="testOrientation()">æª¢æ¸¬æ–¹å‘</button>
            <div id="orientation-result"></div>
        </div>
        
        <div class="test-item">
            <div class="status">å„ªåŒ–å™¨ç‹€æ…‹:</div>
            <div id="optimizer-status">æª¢æ¸¬ä¸­...</div>
        </div>
        
        <div class="test-item">
            <button class="btn" onclick="runAllTests()">ğŸ”„ é‡æ–°æª¢æ¸¬</button>
            <button class="btn" onclick="window.location.href='index.html'">è¿”å›ä¸»æ‡‰ç”¨</button>
        </div>
    </div>

    <script>
        // è¨­å®šè¦–çª—é«˜åº¦è®Šæ•¸
        function setViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        setViewportHeight();
        window.addEventListener('resize', setViewportHeight);
        window.addEventListener('orientationchange', () => {
            setTimeout(setViewportHeight, 100);
        });
        
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent) || 
                         (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
            const isStandalone = window.navigator.standalone === true || 
                               window.matchMedia('(display-mode: standalone)').matches;
            
            return {
                userAgent: userAgent,
                isSafari: isSafari,
                isIOS: isIOS,
                isStandalone: isStandalone,
                platform: navigator.platform,
                maxTouchPoints: navigator.maxTouchPoints
            };
        }
        
        function getViewportInfo() {
            return {
                innerWidth: window.innerWidth,
                innerHeight: window.innerHeight,
                outerWidth: window.outerWidth,
                outerHeight: window.outerHeight,
                screenWidth: screen.width,
                screenHeight: screen.height,
                devicePixelRatio: window.devicePixelRatio,
                orientation: window.innerWidth > window.innerHeight ? 'landscape' : 'portrait'
            };
        }
        
        function getPWAInfo() {
            return {
                serviceWorkerSupported: 'serviceWorker' in navigator,
                manifestSupported: 'manifest' in document.createElement('link'),
                notificationSupported: 'Notification' in window,
                pushSupported: 'PushManager' in window,
                installPromptSupported: 'onbeforeinstallprompt' in window
            };
        }
        
        function getSafeAreaInfo() {
            const testElement = document.createElement('div');
            testElement.style.position = 'fixed';
            testElement.style.top = '0';
            testElement.style.left = '0';
            testElement.style.paddingTop = 'env(safe-area-inset-top)';
            testElement.style.paddingRight = 'env(safe-area-inset-right)';
            testElement.style.paddingBottom = 'env(safe-area-inset-bottom)';
            testElement.style.paddingLeft = 'env(safe-area-inset-left)';
            testElement.style.visibility = 'hidden';
            document.body.appendChild(testElement);
            
            const computedStyle = getComputedStyle(testElement);
            const safeArea = {
                top: computedStyle.paddingTop,
                right: computedStyle.paddingRight,
                bottom: computedStyle.paddingBottom,
                left: computedStyle.paddingLeft
            };
            
            document.body.removeChild(testElement);
            return safeArea;
        }
        
        function testTouch() {
            const result = document.getElementById('touch-result');
            result.innerHTML = `<div style="margin-top: 10px; color: #4CAF50;">âœ… è§¸æ§å›é¥‹æ­£å¸¸ (${new Date().toLocaleTimeString()})</div>`;
        }
        
        function testVibration() {
            if ('vibrate' in navigator) {
                navigator.vibrate(100);
                const result = document.getElementById('touch-result');
                result.innerHTML = `<div style="margin-top: 10px; color: #4CAF50;">âœ… éœ‡å‹•åŠŸèƒ½å¯ç”¨</div>`;
            } else {
                const result = document.getElementById('touch-result');
                result.innerHTML = `<div style="margin-top: 10px; color: #FF9800;">âš ï¸ éœ‡å‹•åŠŸèƒ½ä¸æ”¯æ´</div>`;
            }
        }
        
        function testOrientation() {
            const result = document.getElementById('orientation-result');
            const orientation = window.innerWidth > window.innerHeight ? 'æ©«å‘' : 'ç›´å‘';
            result.innerHTML = `<div style="margin-top: 10px; color: #4CAF50;">ç›®å‰æ–¹å‘: ${orientation} (${window.innerWidth}x${window.innerHeight})</div>`;
        }
        
        function updateDisplay() {
            const browserInfo = detectBrowser();
            const viewportInfo = getViewportInfo();
            const pwaInfo = getPWAInfo();
            const safeAreaInfo = getSafeAreaInfo();
            
            // ç€è¦½å™¨è³‡è¨Š
            document.getElementById('browser-details').innerHTML = `
                <div>Safari: ${browserInfo.isSafari ? 'âœ…' : 'âŒ'}</div>
                <div>iOS: ${browserInfo.isIOS ? 'âœ…' : 'âŒ'}</div>
                <div>Android: ${/Android/i.test(navigator.userAgent) ? 'âœ…' : 'âŒ'}</div>
                <div>Mobile: ${/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? 'âœ…' : 'âŒ'}</div>
                <div>Standalone: ${browserInfo.isStandalone ? 'âœ…' : 'âŒ'}</div>
                <div>Platform: ${browserInfo.platform}</div>
                <div>Touch Points: ${browserInfo.maxTouchPoints}</div>
            `;
            
            // è¦–çª—è³‡è¨Š
            document.getElementById('viewport-details').innerHTML = `
                <div>è¦–çª—: ${viewportInfo.innerWidth}x${viewportInfo.innerHeight}</div>
                <div>è¢å¹•: ${viewportInfo.screenWidth}x${viewportInfo.screenHeight}</div>
                <div>DPR: ${viewportInfo.devicePixelRatio}</div>
                <div>æ–¹å‘: ${viewportInfo.orientation}</div>
            `;
            
            // PWA è³‡è¨Š
            document.getElementById('pwa-details').innerHTML = `
                <div>Service Worker: ${pwaInfo.serviceWorkerSupported ? 'âœ…' : 'âŒ'}</div>
                <div>Manifest: ${pwaInfo.manifestSupported ? 'âœ…' : 'âŒ'}</div>
                <div>Notifications: ${pwaInfo.notificationSupported ? 'âœ…' : 'âŒ'}</div>
                <div>Push: ${pwaInfo.pushSupported ? 'âœ…' : 'âŒ'}</div>
            `;
            
            // å®‰å…¨å€åŸŸè³‡è¨Š
            document.getElementById('safe-area-details').innerHTML = `
                <div>Top: ${safeAreaInfo.top}</div>
                <div>Right: ${safeAreaInfo.right}</div>
                <div>Bottom: ${safeAreaInfo.bottom}</div>
                <div>Left: ${safeAreaInfo.left}</div>
            `;
            
            // å„ªåŒ–å™¨ç‹€æ…‹
            if (window.unifiedMobileOptimizer) {
                const status = window.unifiedMobileOptimizer.getStatus();
                document.getElementById('optimizer-status').innerHTML = `
                    <div style="color: #4CAF50;">âœ… çµ±ä¸€ Mobile å„ªåŒ–å™¨å·²è¼‰å…¥</div>
                    <div>ç‹€æ…‹: ${JSON.stringify(status, null, 2)}</div>
                `;
            } else {
                document.getElementById('optimizer-status').innerHTML = `
                    <div style="color: #FF9800;">âš ï¸ çµ±ä¸€ Mobile å„ªåŒ–å™¨æœªè¼‰å…¥</div>
                `;
            }
        }
        
        function runAllTests() {
            updateDisplay();
            testOrientation();
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', updateDisplay);
        window.addEventListener('resize', updateDisplay);
        window.addEventListener('orientationchange', () => {
            setTimeout(updateDisplay, 100);
        });
    </script>
</body>
</html>