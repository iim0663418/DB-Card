<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸ä½åç‰‡ | ä½¿ç”¨è€…å…¥å£</title>
    <link rel="icon" type="image/png" sizes="192x192" href="favicon.png">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=Noto+Sans+TC:wght@300;500;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/tailwind.css">
    <link rel="stylesheet" href="/css/v4-design.css">
    <script src="/js/tailwind-suppress.js"></script>
    <!-- Vite Icon Bundle (Tree-shaken: 11.62 KB, 96.9% reduction) -->
    <script type="module" src="/dist/icons.-k7gZ0Em.js"></script>
    <script src="/vendor/three.min.js"
            integrity="sha384-CI3ELBVUz9XQO+97x6nwMDPosPR5XvsxW2ua7N1Xeygeh1IxtgqtCkGfQY9WWdHu"
            crossorigin="anonymous"
            defer></script>
    <script src="/vendor/purify.min.js"
            integrity="sha384-qJNkHwhlYywDHfyoEe1np+1lYvX/8x+3gHCKFhSSBMQyCFlvFnn+zXmaebXl21rV"
            crossorigin="anonymous"
            defer></script>
    <script src="/js/social-link-validation.js"></script>
    <script src="/js/social-link-integration.js"></script>
    <style>

        :root {
            --moda-accent: #6868ac;
            --moda-glow: rgba(104, 104, 172, 0.2);
            --crystal-bg: rgba(255, 255, 255, 0.5);
            --ui-text: #1e1e3f;
        }

        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, rgba(244,247,249,0.3) 0%, rgba(230,235,240,0.4) 100%);
            color: var(--ui-text);
            margin: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        #three-canvas {
            position: fixed;
            top: 0; left: 0; z-index: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0.6;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(104, 104, 172, 0.12), 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        /* é›™èªè¼¸å…¥æ¡†çµ„åˆ */
        .bilingual-field {
            display: grid;
            grid-template-columns: 40% 60%;
            gap: 1px;
            background: #e2e8f0;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        
        @media (max-width: 640px) {
            .bilingual-field {
                grid-template-columns: 1fr;
                gap: 1px;
            }
        }
        .bilingual-field input, .bilingual-field textarea {
            background: #fff;
            padding: 14px 18px;
            font-size: 14px;
            border: none;
            outline: none;
        }
        .bilingual-field input:focus, .bilingual-field textarea:focus {
            background: #fdfdff;
            z-index: 10;
            box-shadow: inset 0 0 0 2px var(--moda-accent);
        }

        /* å¡ç‰‡é¸æ“‡ä½æ¨£å¼å„ªåŒ– */
        .selection-card {
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(104, 104, 172, 0.05);
        }
        .selection-card:hover:not(.disabled) {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px -10px rgba(104, 104, 172, 0.2);
            border-color: var(--moda-accent);
        }
        .selection-card.revoked {
            border: 2px solid #ef4444;
            background: rgba(254, 242, 242, 0.8);
        }

        .btn-google {
            background: white;
            border: 1px solid #dadce0;
            color: #3c4043;
            transition: all 0.2s;
        }
        .btn-google:hover:not(:disabled) {
            background-color: #f8f9fa;
            box-shadow: 0 1px 3px rgba(60,64,67,0.3);
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
        }
        .loading-overlay:not(.hidden) {
            display: flex;
        }

        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* MODA Accent é¡è‰²è¦†è“‹ Tailwind indigo */
        .bg-moda { background-color: var(--moda-accent) !important; }
        .text-moda { color: var(--moda-accent) !important; }
        .border-moda { border-color: var(--moda-accent) !important; }
        .hover\:bg-moda:hover { background-color: #5858a0 !important; }
        .hover\:text-moda:hover { color: var(--moda-accent) !important; }
        .hover\:border-moda:hover { border-color: var(--moda-accent) !important; }
        .focus\:border-moda:focus { border-color: var(--moda-accent) !important; }
        .shadow-moda { box-shadow: 0 20px 25px -5px rgba(104, 104, 172, 0.1), 0 8px 10px -6px rgba(104, 104, 172, 0.1) !important; }

        .social-chip-prev {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(104, 104, 172, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--moda-accent);
            transition: all 0.2s;
        }

        /* Modal å‹•ç•« */
        #success-modal {
            animation: fadeIn 0.2s ease-out;
        }

        #success-modal .modal-content {
            animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Mobile Modal å„ªåŒ– */
        @media (max-width: 640px) {
            #success-modal .modal-content {
                max-height: 90vh;
                overflow-y: auto;
                padding: 1.5rem;
            }

            #success-modal .modal-content h3 {
                font-size: 1.25rem;
            }
        }

        /* MODA hover/90 æ•ˆæœ */
        .bg-moda\/90 {
            background-color: rgba(104, 104, 172, 0.9);
        }

        .hover\:bg-moda\/90:hover {
            background-color: rgba(104, 104, 172, 0.9);
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 lg:p-8">

    <canvas id="three-canvas"></canvas>

    <!-- Loading é®ç½© -->
    <div id="global-loading" class="loading-overlay hidden">
        <div class="flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-moda opacity-20 border-t-moda rounded-full animate-spin"></div>
            <p class="text-xs font-black text-moda uppercase tracking-widest" data-i18n="processing">Processing Request</p>
        </div>
    </div>

    <!-- é ‚éƒ¨å°èˆªåˆ— -->
    <header id="app-header" class="hidden fixed top-0 left-0 right-0 z-50 p-6 flex justify-between items-center pointer-events-none">
        <div class="flex items-center gap-3 bg-white/60 backdrop-blur-md px-5 py-2.5 rounded-2xl border border-white/50 pointer-events-auto shadow-sm">
            <div class="w-8 h-8 bg-moda text-white rounded-lg flex items-center justify-center">
                <i data-lucide="component" class="w-5 h-5"></i>
            </div>
            <span class="text-sm font-black tracking-tight uppercase">User Portal</span>
        </div>
        <div class="flex items-center gap-4 pointer-events-auto">
            <!-- BDD Scenario 5-6: å€‹äººåŒ–æ­¡è¿è¨Šæ¯ -->
            <div class="hidden md:flex items-center gap-3">
                <img id="user-avatar-display" src="" alt="" class="w-9 h-9 rounded-full border-2 border-white shadow-sm hidden">
                <div class="flex flex-col items-end">
                    <span id="user-name-display" class="text-sm font-black text-slate-700">---</span>
                    <span id="user-email-display" class="text-xs font-bold text-slate-400 uppercase tracking-widest">---</span>
                </div>
            </div>
            <button onclick="handleLogout()" class="px-6 py-2.5 bg-white border border-slate-200 rounded-xl text-xs font-black text-slate-700 hover:text-red-600 transition-all uppercase tracking-widest shadow-sm">
                Logout
            </button>
        </div>
    </header>

    <!-- ä¸»è¦è¦–åœ– -->
    <main id="view-container" class="relative z-10 w-full max-w-6xl mt-20 lg:mt-24">

        <!-- 1. OAuth ç™»å…¥é  -->
        <section id="view-login" class="flex flex-col items-center justify-center min-h-[70vh] space-y-10 fade-in">
            <div class="text-center space-y-4">
                <div class="w-20 h-20 bg-moda text-white rounded-[2rem] flex items-center justify-center shadow-2xl mx-auto mb-8">
                    <i data-lucide="user-circle" class="w-10 h-10"></i>
                </div>
                <h1 class="text-4xl font-black tracking-tighter" data-i18n="login-title">DB-Card æ•¸ä½åç‰‡ç³»çµ±</h1>
                <p class="text-slate-400 font-medium" data-i18n="login-subtitle">è«‹ä½¿ç”¨å…§éƒ¨ Google å¸³è™Ÿç™»å…¥</p>
            </div>

            <div class="glass-panel p-6 sm:p-10 rounded-[2rem] sm:rounded-[3rem] w-full max-w-md space-y-6 sm:space-y-8 text-center">
                <div id="login-error-box" class="hidden p-4 bg-red-50 border border-red-100 rounded-2xl text-xs text-red-600 font-bold mb-4">
                    <!-- éŒ¯èª¤è¨Šæ¯æ³¨å…¥ -->
                </div>
                <button id="google-login-btn" onclick="handleGoogleLogin()" class="btn-google w-full flex items-center justify-center gap-4 py-4 rounded-2xl font-bold text-sm">
                    <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" class="w-5 h-5" alt="Google">
                    <span data-i18n="login-button">ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥</span>
                </button>
                <div class="space-y-2">
                    <p class="text-xs font-black text-slate-400 uppercase tracking-[0.2em]" data-i18n="login-restriction">åƒ…é™æˆæ¬Šä½¿ç”¨è€…</p>
                </div>
            </div>
        </section>

        <!-- 2. å¡ç‰‡é¸æ“‡é  -->
        <section id="view-selection" class="hidden space-y-12 fade-in">
            <div class="flex flex-col items-center text-center space-y-2">
                <h2 class="text-3xl font-black tracking-tight" data-i18n="selection-title">æˆ‘çš„æ•¸ä½åç‰‡åº«</h2>
                <p class="text-slate-400 font-medium text-sm leading-relaxed" data-i18n="selection-subtitle">æ‚¨æœ€å¤šå¯æŒæœ‰ä¸‰ç¨®ç”¨é€”çš„æ•¸ä½åç‰‡</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8" id="card-slots-container">
                <!-- Slot Template (ç”± JS æ¸²æŸ“) -->
            </div>

            <!-- Privacy Management Section -->
            <div class="glass-panel p-6 lg:p-8 rounded-[2rem] lg:rounded-[3rem] space-y-6">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i data-lucide="shield" class="w-5 h-5 text-blue-600"></i>
                    </div>
                    <h3 class="text-lg font-black text-slate-900" data-i18n="privacy-settings-title">å€‹è³‡ç®¡ç†</h3>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <button onclick="showConsentHistoryModal()" class="py-4 bg-white border border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition-all text-sm flex items-center justify-center gap-2">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span data-i18n="privacy-view-history">æŸ¥çœ‹åŒæ„æ­·å²</span>
                    </button>
                    <button onclick="handleDataExport()" class="py-4 bg-white border border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition-all text-sm flex items-center justify-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        <span data-i18n="privacy-export-data">åŒ¯å‡ºæˆ‘çš„è³‡æ–™</span>
                    </button>
                    <button onclick="showWithdrawConsentModal()" class="py-4 bg-white border border-red-200 text-red-600 rounded-xl font-bold hover:bg-red-50 transition-all text-sm flex items-center justify-center gap-2">
                        <i data-lucide="user-x" class="w-4 h-4"></i>
                        <span data-i18n="privacy-withdraw-consent">æ’¤å›åŒæ„</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- 3. å¡ç‰‡ç·¨è¼¯è¡¨å–® -->
        <section id="view-form" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-10 fade-in">
            <div class="lg:col-span-8 space-y-8">
                <div class="flex items-center gap-4 mb-2">
                    <button onclick="showView('selection')" class="p-3 bg-white border border-slate-200 rounded-2xl hover:bg-slate-50 transition-colors">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <div>
                        <h2 id="form-title" class="text-2xl font-black tracking-tight" data-i18n="form-title">ç·¨è¼¯æ•¸ä½åç‰‡</h2>
                        <p id="form-subtitle" class="text-xs text-slate-400 font-bold uppercase tracking-widest" data-i18n="form-subtitle">Self-Service Issuance</p>
                    </div>
                </div>

                <form id="edit-form" class="glass-panel p-6 lg:p-10 rounded-[2rem] lg:rounded-[3rem] space-y-6 lg:space-y-8">
                    <!-- éš±è—æ¬„ä½ -->
                    <input type="hidden" id="form-type" name="form-type">
                    <input type="hidden" id="form-uuid" name="form-uuid">

                    <!-- å§“åèˆ‡è·ç¨± -->
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <div class="flex justify-between text-xs font-black text-slate-400 uppercase tracking-widest px-1">
                                <span>ä¸­æ–‡å§“å *</span><span>è‹±æ–‡å§“å *</span>
                            </div>
                            <div class="bilingual-field">
                                <input type="text" id="name_zh" name="name_zh" placeholder="ç‹å¤§æ˜" required aria-label="ä¸­æ–‡å§“å">
                                <input type="text" id="name_en" name="name_en" placeholder="John Smith" required aria-label="English Name">
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex justify-between text-xs font-black text-slate-400 uppercase tracking-widest px-1">
                                <span>ä¸­æ–‡è·ç¨±</span><span>è‹±æ–‡è·ç¨±</span>
                            </div>
                            <div class="bilingual-field">
                                <input type="text" id="title_zh" name="title_zh" placeholder="ç§‘é•·" aria-label="ä¸­æ–‡è·ç¨±">
                                <input type="text" id="title_en" name="title_en" placeholder="Section Chief" aria-label="English Title">
                            </div>
                        </div>
                    </div>

                    <!-- éƒ¨é–€é¸æ“‡ä¸‹æ‹‰é¸å–® -->
                    <div class="space-y-2">
                        <label for="department-preset" class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-department">é¸æ“‡æ‚¨çš„æ‰€å±¬éƒ¨é–€</label>
                        <select id="department-preset" name="department" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold appearance-none">
                            <option value="">è«‹é¸æ“‡éƒ¨é–€</option>
                            <option value="æ•¸ä½ç­–ç•¥å¸">æ•¸ä½ç­–ç•¥å¸</option>
                            <option value="æ•¸ä½æ”¿åºœå¸">æ•¸ä½æ”¿åºœå¸</option>
                            <option value="è³‡æºç®¡ç†å¸">è³‡æºç®¡ç†å¸</option>
                            <option value="éŸŒæ€§å»ºè¨­å¸">éŸŒæ€§å»ºè¨­å¸</option>
                            <option value="æ•¸ä½åœ‹éš›å¸">æ•¸ä½åœ‹éš›å¸</option>
                            <option value="è³‡æ–™å‰µæ–°å¸">è³‡æ–™å‰µæ–°å¸</option>
                            <option value="ç§˜æ›¸è™•">ç§˜æ›¸è™•</option>
                            <option value="äººäº‹è™•">äººäº‹è™•</option>
                            <option value="æ”¿é¢¨è™•">æ”¿é¢¨è™•</option>
                            <option value="ä¸»è¨ˆè™•">ä¸»è¨ˆè™•</option>
                            <option value="è³‡è¨Šè™•">è³‡è¨Šè™•</option>
                            <option value="æ³•åˆ¶è™•">æ³•åˆ¶è™•</option>
                            <option value="éƒ¨é•·å®¤">éƒ¨é•·å®¤</option>
                            <option value="æ”¿å‹™æ¬¡é•·å®¤">æ”¿å‹™æ¬¡é•·å®¤</option>
                            <option value="å¸¸å‹™æ¬¡é•·å®¤">å¸¸å‹™æ¬¡é•·å®¤</option>
                            <option value="ä¸»ä»»ç§˜æ›¸å®¤">ä¸»ä»»ç§˜æ›¸å®¤</option>
                            <option value="custom">è‡ªè¨‚éƒ¨é–€</option>
                        </select>

                        <div id="custom-department-field" class="hidden space-y-2">
                            <input type="text" id="department-custom-zh" name="department_custom_zh" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" placeholder="è¼¸å…¥éƒ¨é–€åç¨±" aria-label="è‡ªè¨‚éƒ¨é–€ä¸­æ–‡åç¨±">
                            <input type="text" id="department-custom-en" name="department_custom_en" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" placeholder="Department Name" aria-label="Custom Department English Name">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="email" class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-email">Email *</label>
                            <input type="email" id="email" name="email" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" data-i18n-placeholder="placeholder-email" required>
                        </div>
                        <div class="space-y-2">
                            <label for="phone" class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-phone">è¾¦å…¬å®¤é›»è©±</label>
                            <input type="text" id="phone" name="phone" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" data-i18n-placeholder="placeholder-phone">
                        </div>
                    </div>

                    <!-- å®˜ç¶²é€£çµ -->
                    <div class="space-y-2">
                        <label for="web" class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-web">å®˜æ–¹ç¶²ç«™é€£çµ</label>
                        <input type="url" id="web" name="web" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" data-i18n-placeholder="placeholder-web">
                    </div>

                    <!-- åœ°å€é è¨­é¸æ“‡ + è‡ªè¨‚ -->
                    <div class="space-y-2">
                        <label for="address-preset" class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-address">è¾¦å…¬åœ°å€</label>
                        <select id="address-preset" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold appearance-none mb-2">
                            <option value="">é¸æ“‡é è¨­åœ°å€æˆ–è‡ªè¨‚</option>
                            <option value="yanping">å»¶å¹³å¤§æ¨“ï¼ˆæ•¸ä½ç™¼å±•éƒ¨ï¼‰</option>
                            <option value="shinkong">æ–°å…‰å¤§æ¨“ï¼ˆæ•¸ä½ç™¼å±•éƒ¨ï¼‰</option>
                            <option value="custom">è‡ªè¨‚åœ°å€</option>
                        </select>

                        <div id="custom-address-fields" class="hidden space-y-2">
                            <input type="text" id="address_zh" name="address_zh" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" placeholder="10058 å°åŒ—å¸‚ä¸­æ­£å€å»¶å¹³å—è·¯143è™Ÿ" aria-label="ä¸­æ–‡åœ°å€">
                            <input type="text" id="address_en" name="address_en" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" placeholder="No. 143, Yanping S. Rd., Taipei 10058" aria-label="English Address">
                        </div>
                    </div>

                    <!-- é€²éšè³‡è¨ŠæŠ˜ç–Šå€ -->
                    <details class="group border-t border-slate-100 pt-6 mt-6">
                        <summary class="list-none cursor-pointer flex items-center justify-between text-xs font-black text-moda hover:text-moda transition-colors uppercase tracking-widest">
                            <span data-i18n="advanced-section">é€²éšèˆ‡ç¤¾ç¾¤è³‡è¨Šï¼ˆé¸å¡«ï¼‰</span>
                            <i data-lucide="chevron-down" class="w-4 h-4 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="pt-6 space-y-6">
                            <!-- æ‰‹æ©Ÿ & å¤§é ­è²¼ -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label for="mobile" class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-mobile">æ‰‹æ©Ÿè™Ÿç¢¼</label>
                                    <input type="text" id="mobile" name="mobile" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" data-i18n-placeholder="placeholder-mobile">
                                </div>
                                <div class="space-y-2">
                                    <label for="avatar_url" class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-avatar">å¤§é ­è²¼é€£çµ</label>
                                    <input type="url" id="avatar_url" name="avatar_url" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda font-bold" data-i18n-placeholder="placeholder-avatar">
                                    <p class="text-xs text-slate-500 ml-1 leading-relaxed">
                                        ğŸ’¡ ä½¿ç”¨ Google Driveï¼šåˆ†äº«æ™‚è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„ä»»ä½•äººã€
                                    </p>
                                </div>
                            </div>

                            <!-- é—œæ–¼æˆ‘ -->
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs font-black text-slate-400 uppercase tracking-widest px-1">
                                    <span data-i18n="label-greeting">é—œæ–¼æˆ‘ï¼ˆä¸­æ–‡ï¼‰</span><span data-i18n="label-greeting">é—œæ–¼æˆ‘ï¼ˆè‹±æ–‡ï¼‰</span>
                                </div>
                                <div class="bilingual-field">
                                    <textarea id="greetings_zh" name="greetings_zh" class="h-24 resize-none" data-i18n-placeholder="placeholder-greeting-zh" aria-label="é—œæ–¼æˆ‘ï¼ˆä¸­æ–‡ï¼‰"></textarea>
                                    <textarea id="greetings_en" name="greetings_en" class="h-24 resize-none" data-i18n-placeholder="placeholder-greeting-en" aria-label="About Me (English)"></textarea>
                                </div>
                            </div>

                            <!-- ç¤¾ç¾¤é€£çµ -->
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <label class="text-sm font-black text-slate-400 uppercase tracking-widest ml-1" data-i18n="label-social">ç¤¾ç¾¤é€£çµ</label>
                                    <span class="text-xs text-slate-400 leading-relaxed">é¸å¡«ï¼Œæ–¹ä¾¿ä»–äººè¯ç¹«</span>
                                </div>

                                <!-- GitHub -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="github" class="w-4 h-4 text-slate-600"></i>
                                    </div>
                                    <input type="url" id="social_github" name="social_github" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-xl outline-none focus:border-moda text-sm" data-i18n-placeholder="placeholder-github">
                                </div>

                                <!-- LinkedIn -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="linkedin" class="w-4 h-4 text-slate-600"></i>
                                    </div>
                                    <input type="url" id="social_linkedin" name="social_linkedin" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-xl outline-none focus:border-moda text-sm" data-i18n-placeholder="placeholder-linkedin">
                                </div>

                                <!-- Facebook -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="facebook" class="w-4 h-4 text-slate-600"></i>
                                    </div>
                                    <input type="url" id="social_facebook" name="social_facebook" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-xl outline-none focus:border-moda text-sm" placeholder="https://facebook.com/username">
                                </div>

                                <!-- Instagram -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="instagram" class="w-4 h-4 text-slate-600"></i>
                                    </div>
                                    <input type="url" id="social_instagram" name="social_instagram" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-xl outline-none focus:border-moda text-sm" placeholder="https://instagram.com/username">
                                </div>

                                <!-- X/Twitter -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="twitter" class="w-4 h-4 text-slate-600"></i>
                                    </div>
                                    <input type="url" id="social_twitter" name="social_twitter" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-xl outline-none focus:border-moda text-sm" data-i18n-placeholder="placeholder-twitter">
                                </div>

                                <!-- YouTube -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i data-lucide="youtube" class="w-4 h-4 text-slate-600"></i>
                                    </div>
                                    <input type="url" id="social_youtube" name="social_youtube" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-xl outline-none focus:border-moda text-sm" placeholder="https://youtube.com/@channel">
                                </div>

                                <!-- LINE -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <svg class="w-4 h-4 text-slate-600" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                                        </svg>
                                    </div>
                                    <input type="text" id="social_line" name="social_line" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-xl outline-none focus:border-moda text-sm" placeholder="LINE ID æˆ–å®Œæ•´é€£çµ" aria-label="LINE">
                                </div>

                                <!-- Signal -->
                                <div class="flex items-center gap-2">
                                    <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <svg class="w-4 h-4 text-slate-600" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 0q-.934 0-1.83.139l.17 1.111a11 11 0 0 1 3.32 0l.172-1.111A12 12 0 0 0 12 0M9.152.34A12 12 0 0 0 5.77 1.742l.584.961a10.8 10.8 0 0 1 3.066-1.27zm5.696 0-.268 1.094a10.8 10.8 0 0 1 3.066 1.27l.584-.962A12 12 0 0 0 14.848.34M12 2.25a9.75 9.75 0 0 0-8.539 14.459c.074.134.1.292.064.441l-1.013 4.338 4.338-1.013a.62.62 0 0 1 .441.064A9.7 9.7 0 0 0 12 21.75c5.385 0 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25m-7.092.068a12 12 0 0 0-2.59 2.59l.909.664a11 11 0 0 1 2.345-2.345zm14.184 0-.664.909a11 11 0 0 1 2.345 2.345l.909-.664a12 12 0 0 0-2.59-2.59M1.742 5.77A12 12 0 0 0 .34 9.152l1.094.268a10.8 10.8 0 0 1 1.269-3.066zm20.516 0-.961.584a10.8 10.8 0 0 1 1.27 3.066l1.093-.268a12 12 0 0 0-1.402-3.383M.138 10.168A12 12 0 0 0 0 12q0 .934.139 1.83l1.111-.17A11 11 0 0 1 1.125 12q0-.848.125-1.66zm23.723.002-1.111.17q.125.812.125 1.66c0 .848-.042 1.12-.125 1.66l1.111.172a12.1 12.1 0 0 0 0-3.662M1.434 14.58l-1.094.268a12 12 0 0 0 .96 2.591l-.265 1.14 1.096.255.36-1.539-.188-.365a10.8 10.8 0 0 1-.87-2.35m21.133 0a10.8 10.8 0 0 1-1.27 3.067l.962.584a12 12 0 0 0 1.402-3.383zm-1.793 3.848a11 11 0 0 1-2.345 2.345l.664.909a12 12 0 0 0 2.59-2.59zm-19.959 1.1L.357 21.48a1.8 1.8 0 0 0 2.162 2.161l1.954-.455-.256-1.095-1.953.455a.675.675 0 0 1-.81-.81l.454-1.954zm16.832 1.769a10.8 10.8 0 0 1-3.066 1.27l.268 1.093a12 12 0 0 0 3.382-1.402zm-10.94.213-1.54.36.256 1.095 1.139-.266c.814.415 1.683.74 2.591.961l.268-1.094a10.8 10.8 0 0 1-2.35-.869zm3.634 1.24-.172 1.111a12.1 12.1 0 0 0 3.662 0l-.17-1.111q-.812.125-1.66.125a11 11 0 0 1-1.66-.125"/>
                                        </svg>
                                    </div>
                                    <input type="text" id="social_signal" name="social_signal" class="flex-1 px-5 py-3 bg-white border border-slate-200 rounded-2xl outline-none focus:border-moda text-sm" placeholder="+886912345678" aria-label="Signal">
                                </div>
                            </div>
                        </div>
                    </details>

                    <div id="form-error-msg" class="hidden p-4 bg-red-50 border border-red-200 text-red-600 rounded-2xl text-xs font-bold"></div>

                    <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-6">
                        <button type="button" onclick="showView('selection')" class="sm:flex-1 py-4 bg-slate-100 text-slate-600 rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-slate-200" data-i18n="button-cancel">å–æ¶ˆ</button>
                        <button id="submit-btn" type="submit" class="sm:flex-[2] py-4 bg-moda text-white rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-moda shadow-xl shadow-moda transition-all">
                            <span id="submit-btn-text" data-i18n="button-submit">å„²å­˜ä¸¦é è¦½åç‰‡</span>
                            <span id="submit-btn-loading" class="hidden">
                                <i data-lucide="loader-2" class="w-4 h-4 inline animate-spin"></i> å„²å­˜ä¸­...
                            </span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- å³å´é è¦½ -->
            <div class="lg:col-span-4 space-y-6">
                <div class="glass-panel p-6 lg:p-8 rounded-[3rem] lg:sticky lg:top-28 text-center flex flex-col items-center">
                    <p class="text-xs font-black text-moda opacity-60 uppercase tracking-[0.3em] mb-10" data-i18n="preview-title">Real-time Context</p>
                    <div id="preview-lang-switch" class="flex bg-slate-100 p-1 rounded-lg mb-6">
                        <button data-lang="zh" class="px-4 py-1 text-xs font-bold rounded-md bg-white shadow-sm transition-all">ä¸­</button>
                        <button data-lang="en" class="px-4 py-1 text-xs font-bold rounded-md text-slate-500 hover:text-slate-900 transition-all">EN</button>
                    </div>
                    <div id="preview-card" class="w-full max-w-[240px] sm:max-w-[260px] bg-white rounded-[2rem] sm:rounded-[3rem] shadow-2xl border-t-[6px] sm:border-t-[8px] border-t-moda p-6 sm:p-8 space-y-4 sm:space-y-6">
                        <img id="prev-avatar" src="" class="w-24 h-24 rounded-[2rem] mx-auto object-cover border-2 border-slate-50 hidden">
                        <div>
                            <h3 id="prev-name" class="text-2xl font-black italic">---</h3>
                            <p id="prev-title" class="text-moda font-bold text-xs uppercase tracking-widest mt-2">---</p>
                            <p id="prev-department" class="text-sm text-slate-500 mt-1 flex items-center gap-1 justify-center" style="display:none;">
                                <i data-lucide="briefcase" class="w-3 h-3 flex-shrink-0"></i>
                                <span id="prev-department-text" class="truncate max-w-[200px]">---</span>
                            </p>
                        </div>

                        <!-- ç¤¾ç¾¤åœ–æ¨™é è¦½ -->
                        <div id="prev-social-cluster" class="flex justify-center gap-2 flex-wrap min-h-[32px] mt-4">
                            <!-- å‹•æ…‹ç”Ÿæˆ -->
                        </div>

                        <!-- é—œæ–¼æˆ‘å€å¡Š -->
                        <div id="prev-greeting-section" class="mt-6 pt-6 border-t border-moda opacity-20 hidden">
                            <p class="text-xs font-black tracking-widest text-slate-400 uppercase mb-3 opacity-40">é—œæ–¼æˆ‘ About Me</p>
                            <p id="prev-greeting" class="text-slate-600 font-medium italic text-xs"></p>
                        </div>

                        <!-- Email -->
                        <div class="bg-slate-50 p-3 rounded-xl flex items-center gap-3 text-left mt-2">
                            <i data-lucide="mail" class="w-4 h-4 text-moda opacity-60"></i>
                            <span id="prev-email" class="text-xs font-bold text-slate-600 truncate">---</span>
                        </div>

                        <!-- Phone -->
                        <div class="bg-slate-50 p-3 rounded-xl flex items-center gap-3 text-left mt-2">
                            <i data-lucide="phone" class="w-4 h-4 text-moda opacity-60"></i>
                            <span id="prev-phone" class="text-xs font-bold text-slate-600 truncate">---</span>
                        </div>

                        <!-- Web -->
                        <div id="prev-web-container" class="bg-slate-50 p-3 rounded-xl flex items-center gap-3 text-left mt-2" style="display:none;">
                            <i data-lucide="globe" class="w-4 h-4 text-moda opacity-60"></i>
                            <span id="prev-web" class="text-xs font-bold text-slate-600 truncate">---</span>
                        </div>

                        <!-- Mobile -->
                        <div id="prev-mobile-container" class="bg-slate-50 p-3 rounded-xl flex items-center gap-3 text-left mt-2" style="display:none;">
                            <i data-lucide="smartphone" class="w-4 h-4 text-moda opacity-60"></i>
                            <span id="prev-mobile" class="text-xs font-bold text-slate-600 truncate">---</span>
                        </div>

                        <!-- Address -->
                        <div class="bg-slate-50 p-3 rounded-xl flex items-center gap-3 text-left mt-2">
                            <i data-lucide="map-pin" class="w-4 h-4 text-moda opacity-60"></i>
                            <span id="prev-address" class="text-xs font-bold text-slate-600 truncate">---</span>
                        </div>
                    </div>
                    <p class="text-xs text-slate-400 mt-10 italic uppercase font-bold tracking-widest" data-i18n="preview-footer">Digital Twin Preview</p>
                </div>
            </div>
        </section>
    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[300] px-8 py-4 bg-slate-900 text-white rounded-2xl shadow-2xl text-xs font-bold uppercase tracking-widest hidden fade-in"></div>

    <!-- Consent Modal (First-time / Version Update) -->
    <div id="consent-modal" class="hidden fixed inset-0 z-[250] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full flex flex-col overflow-hidden" style="height: 90vh;">
            <!-- Header -->
            <div class="p-6 border-b border-slate-200">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i data-lucide="shield-check" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-black text-slate-900" data-i18n="consent-title">éš±ç§æ¬Šæ”¿ç­–</h3>
                </div>
                <p class="text-sm text-slate-600" data-i18n="consent-subtitle">è«‹è©³é–±ä»¥ä¸‹æ¢æ¬¾</p>
                <div class="flex gap-4 mt-3 text-xs text-slate-500">
                    <span><strong data-i18n="consent-version">ç‰ˆæœ¬</strong>: <span id="consent-policy-version">---</span></span>
                    <span><strong data-i18n="consent-effective-date">ç”Ÿæ•ˆæ—¥æœŸ</strong>: <span id="consent-effective-date">---</span></span>
                </div>
            </div>

            <!-- Scrollable Content -->
            <div id="consent-content-scroll" class="overflow-y-auto p-6 space-y-6" style="flex: 1 1 0; min-height: 0;">
                <!-- First Layer: Summary + Purposes -->
                <div class="p-4 bg-blue-50 rounded-xl border border-blue-200">
                    <h4 class="text-sm font-black text-blue-900 mb-2" data-i18n="consent-summary-title">æ‘˜è¦</h4>
                    <p id="consent-summary" class="text-sm text-blue-800 leading-relaxed mb-3">è¼‰å…¥ä¸­...</p>
                    
                    <!-- Data Collection Purposes -->
                    <div class="mt-3 pt-3 border-t border-blue-200">
                        <p class="text-xs font-bold text-blue-900 mb-1" data-i18n="consent-purposes-title">è’é›†ç›®çš„</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">069 å¥‘ç´„</span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">090 å®¢æˆ¶ç®¡ç†</span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">135 è³‡è¨Šæœå‹™</span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">157 çµ±è¨ˆåˆ†æ</span>
                        </div>
                    </div>
                    
                    <!-- Toggle Full Content Button -->
                    <button id="toggle-full-content-btn" onclick="toggleFullContent()" class="mt-3 text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1">
                        <span data-i18n="consent-view-full">æŸ¥çœ‹å®Œæ•´æ¢æ¬¾</span>
                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                </div>

                <!-- Second Layer: Full Content (Initially Hidden) -->
                <div id="consent-full-content" class="hidden prose prose-sm max-w-none text-slate-700 p-4 bg-slate-50 rounded-xl">è¼‰å…¥ä¸­...</div>

                <!-- Consents -->
                <div class="space-y-3">
                    <!-- Required Consent -->
                    <div class="flex items-start gap-3 p-4 bg-slate-50 rounded-xl border-2 border-red-100">
                        <input type="checkbox" id="consent-required" disabled checked class="mt-1 w-5 h-5 rounded border-slate-300">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="px-2 py-0.5 bg-red-100 text-red-600 text-xs font-bold rounded" data-i18n="consent-required-badge">å¿…è¦</span>
                                <label class="text-sm font-bold text-slate-900" data-i18n="consent-required-label">æœå‹™ä½¿ç”¨</label>
                            </div>
                            <p class="text-xs text-slate-600" data-i18n="consent-required-desc">æ­¤ç‚ºæœå‹™å¿…è¦é …ç›®ï¼Œç„¡æ³•æ‹’çµ•ã€‚åŒ…å«åŸºæœ¬è³‡æ–™è’é›†ã€åç‰‡å„²å­˜èˆ‡å±•ç¤ºã€ç³»çµ±æ“ä½œæ—¥èªŒã€‚</p>
                        </div>
                    </div>
                    
                    <!-- Optional Consent -->
                    <div class="flex items-start gap-3 p-4 bg-slate-50 rounded-xl border-2 border-blue-100">
                        <input type="checkbox" id="consent-optional-analytics" class="mt-1 w-5 h-5 rounded border-slate-300">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="px-2 py-0.5 bg-blue-100 text-blue-600 text-xs font-bold rounded" data-i18n="consent-optional-badge">é¸æ“‡æ€§</span>
                                <label for="consent-optional-analytics" class="text-sm font-bold text-slate-900" data-i18n="consent-optional-label">åŒ¿åçµ±è¨ˆ</label>
                            </div>
                            <p class="text-xs text-slate-600" data-i18n="consent-optional-desc">å”åŠ©æˆ‘å€‘æ”¹å–„æœå‹™å“è³ªï¼Œä¸åŒ…å«å€‹äººè­˜åˆ¥è³‡è¨Šã€‚æ‚¨å¯éš¨æ™‚è®Šæ›´æ­¤è¨­å®šã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scroll Hint (hidden when scrolled to bottom) -->
            <div id="consent-scroll-hint" class="px-6 py-3 bg-amber-50 border-t border-amber-200 text-center">
                <p class="text-xs text-amber-700 font-medium flex items-center justify-center gap-2">
                    <i data-lucide="arrow-down" class="w-4 h-4"></i>
                    <span data-i18n="consent-scroll-hint">è«‹æ»¾å‹•è‡³åº•éƒ¨é–±è®€å®Œæ•´å…§å®¹</span>
                </p>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t border-slate-200 flex gap-3">
                <button id="consent-agree-btn" disabled onclick="acceptConsent()" 
                    class="flex-1 py-4 rounded-xl font-bold transition-colors disabled:cursor-not-allowed" 
                    style="background-color: #2563eb; color: white;"
                    data-i18n="consent-agree-button">
                    æˆ‘å·²è©³é–±ä¸¦åŒæ„
                </button>
            </div>
        </div>
    </div>

    <!-- Withdraw Consent Modal -->
    <div id="withdraw-consent-modal" class="hidden fixed inset-0 z-[250] flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="alert-triangle" class="w-8 h-8 text-red-600"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-900" data-i18n="withdraw-title">æ’¤å›å€‹è³‡åŒæ„</h3>
                <p class="text-sm text-slate-600 mt-2" data-i18n="withdraw-subtitle">æ’¤å›å¾Œå°‡ç„¡æ³•ä½¿ç”¨æœå‹™</p>
            </div>

            <div class="space-y-4 mb-6">
                <div class="p-4 bg-red-50 border border-red-200 rounded-xl">
                    <p class="text-sm text-red-800 font-medium" data-i18n="withdraw-warning">æ‚¨çš„è³‡æ–™å°‡åœ¨ 30 å¤©å¾Œæ°¸ä¹…åˆªé™¤</p>
                    <p class="text-xs text-red-600 mt-2">
                        <strong data-i18n="withdraw-deletion-date">é è¨ˆåˆªé™¤æ—¥æœŸ</strong>: <span id="withdraw-deletion-date">---</span>
                    </p>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold text-slate-700 block" data-i18n="withdraw-confirm-text">è«‹è¼¸å…¥ã€Œç¢ºèªæ’¤å›ã€ä»¥ç¹¼çºŒ</label>
                    <input type="text" id="withdraw-confirm-input" class="w-full px-4 py-3 border border-slate-300 rounded-xl text-sm" data-i18n-placeholder="withdraw-confirm-placeholder">
                </div>

                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl">
                    <input type="checkbox" id="withdraw-understand-checkbox" class="w-5 h-5 rounded border-slate-300">
                    <label for="withdraw-understand-checkbox" class="text-sm text-slate-700" data-i18n="withdraw-understand-checkbox">æˆ‘äº†è§£æ’¤å›å¾Œæœ</label>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="closeWithdrawConsentModal()" class="flex-1 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200" data-i18n="button-cancel">å–æ¶ˆ</button>
                <button id="withdraw-consent-confirm-btn" disabled onclick="confirmWithdrawConsent()" class="flex-1 px-6 py-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed" data-i18n="withdraw-button">
                    ç¢ºèªæ’¤å›åŒæ„
                </button>
            </div>
        </div>
    </div>

    <!-- Restore Consent Modal -->
    <div id="restore-consent-modal" class="hidden fixed inset-0 z-[250] flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="rotate-ccw" class="w-8 h-8 text-amber-600"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-900" data-i18n="restore-title">æ¢å¾©å€‹è³‡åŒæ„</h3>
                <p class="text-sm text-slate-600 mt-2" data-i18n="restore-subtitle">æ‚¨çš„è³‡æ–™å°‡è¢«ä¿ç•™</p>
            </div>

            <div class="space-y-4 mb-6">
                <div class="p-4 bg-amber-50 border border-amber-200 rounded-xl text-center">
                    <p class="text-sm text-amber-800 font-medium">æ‚¨çš„è³‡æ–™å°‡åœ¨ <span id="restore-days-remaining" class="font-black text-lg">X</span> å¤©å¾Œåˆªé™¤</p>
                    <p class="text-xs text-amber-600 mt-2" data-i18n="restore-days-remaining">å‰©é¤˜æ™‚é–“</p>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="confirmRestoreConsent()" class="flex-1 px-6 py-4 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700" data-i18n="restore-button">
                    å–æ¶ˆæ’¤å›
                </button>
                <button onclick="closeRestoreConsentModal()" class="flex-1 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200" data-i18n="restore-continue-delete">
                    ç¹¼çºŒåˆªé™¤
                </button>
            </div>
        </div>
    </div>

    <!-- Consent History Modal -->
    <div id="consent-history-modal" class="hidden fixed inset-0 z-[250] flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="relative bg-white rounded-2xl shadow-2xl max-w-3xl w-full mx-4 max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-slate-200 flex justify-between items-center">
                <h3 class="text-xl font-black text-slate-900" data-i18n="history-title">åŒæ„æ­·å²è¨˜éŒ„</h3>
                <button onclick="closeConsentHistoryModal()" class="p-2 hover:bg-slate-100 rounded-lg">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div id="consent-history-content" class="flex-1 overflow-y-auto p-6">
                <p class="text-center text-slate-400" data-i18n="history-no-records">è¼‰å…¥ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="hidden fixed inset-0 z-[200] flex items-center justify-center">
        <!-- Backdrop -->
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm"></div>

        <!-- Modal Content -->
        <div class="modal-content relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
            <!-- Header -->
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="check-circle" class="w-8 h-8 text-green-600"></i>
                </div>
                <h3 class="text-xl sm:text-2xl font-black text-slate-900" data-i18n="modal-success-title">åç‰‡å·²å„²å­˜</h3>
                <p id="modal-card-type" class="text-sm text-slate-600 mt-2 leading-relaxed" data-i18n="modal-success-subtitle">æ‚¨çš„åç‰‡å·²æˆåŠŸæ›´æ–°</p>
            </div>

            <!-- Share Link -->
            <div class="mb-6">
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block" data-i18n="modal-share-link">åˆ†äº«é€£çµ</label>
                <div class="flex gap-2">
                    <input id="modal-share-link" type="text" readonly class="flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-mono text-slate-700">
                    <button id="modal-copy-btn" onclick="copyModalLink()" class="px-6 py-3 bg-moda text-white rounded-xl font-bold hover:bg-moda/90 transition-colors flex items-center gap-2 min-h-[48px]">
                        <i data-lucide="copy" class="w-4 h-4"></i>
                        <span id="modal-copy-text" class="hidden sm:inline" data-i18n="button-copy">è¤‡è£½</span>
                    </button>
                </div>
                <p class="text-xs text-slate-500 mt-2" data-i18n="modal-share-desc">å¯é€éæ­¤é€£çµåˆ†äº«æ‚¨çš„åç‰‡</p>
            </div>

            <!-- Next Steps -->
            <div class="mb-6 p-3 sm:p-4 bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl border border-purple-100">
                <h4 class="text-xs font-black text-slate-700 uppercase tracking-wider mb-3 flex items-center gap-2">
                    <i data-lucide="lightbulb" class="w-4 h-4 text-moda"></i>
                    <span class="hidden sm:inline">ä¸‹ä¸€æ­¥æ“ä½œå»ºè­°</span>
                    <span class="sm:hidden">ä¸‹ä¸€æ­¥</span>
                </h4>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    <!-- Add to Home Screen -->
                    <div class="bg-white/80 backdrop-blur-sm p-3 sm:p-4 rounded-xl border border-white/50 hover:border-blue-300 transition-all cursor-default group min-h-[48px]">
                        <div class="flex flex-col items-center text-center gap-2">
                            <div class="w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center group-hover:bg-blue-100 transition-colors">
                                <i data-lucide="home" class="w-5 h-5 text-blue-600"></i>
                            </div>
                            <div>
                                <p class="text-xs font-black text-slate-700" data-i18n="modal-qr-title">åŠ å…¥ä¸»ç•«é¢</p>
                                <p class="text-xs text-slate-500 mt-1" data-i18n="modal-qr-desc">ä¸€éµå¿«é€Ÿé–‹å•Ÿ</p>
                            </div>
                        </div>
                    </div>
                    <!-- NFC Card Writing -->
                    <div class="bg-white/80 backdrop-blur-sm p-3 sm:p-4 rounded-xl border border-white/50 hover:border-moda/30 transition-all cursor-default group min-h-[48px]">
                        <div class="flex flex-col items-center text-center gap-2">
                            <div class="w-10 h-10 bg-moda/10 rounded-lg flex items-center justify-center group-hover:bg-moda/20 transition-colors">
                                <i data-lucide="credit-card" class="w-5 h-5 text-moda"></i>
                            </div>
                            <div>
                                <p class="text-xs font-black text-slate-700" data-i18n="modal-nfc-title">å¯«å…¥ NFC å¡ç‰‡</p>
                                <p class="text-xs text-slate-500 mt-1" data-i18n="modal-nfc-desc">å¯¦é«”å¡ç‰‡å¿«é€Ÿåˆ†äº«</p>
                            </div>
                        </div>
                    </div>
                    <!-- URL Shortening -->
                    <div class="bg-white/80 backdrop-blur-sm p-3 sm:p-4 rounded-xl border border-white/50 hover:border-green-300 transition-all cursor-default group min-h-[48px] sm:col-span-2 lg:col-span-1">
                        <div class="flex flex-col items-center text-center gap-2">
                            <div class="w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center group-hover:bg-green-100 transition-colors">
                                <i data-lucide="link-2" class="w-5 h-5 text-green-600"></i>
                            </div>
                            <div>
                                <p class="text-xs font-black text-slate-700" data-i18n="modal-short-title">ç¸®çŸ­ç¶²å€</p>
                                <p class="text-xs text-slate-500 mt-1" data-i18n="modal-short-desc">æ–¹ä¾¿ç·šä¸Šåˆ†äº«</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex flex-col sm:flex-row gap-3">
                <button id="modal-view-btn" onclick="viewModalCard()" class="flex-1 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200 transition-colors min-h-[48px] text-sm">
                    æŸ¥çœ‹åç‰‡æ•ˆæœ
                </button>
                <button onclick="closeSuccessModal()" class="flex-1 px-6 py-4 bg-moda text-white rounded-xl font-bold hover:bg-moda/90 transition-colors min-h-[48px] text-sm">
                    å®Œæˆ
                </button>
            </div>
        </div>
    </div>

    <!-- Revoke Confirmation Modal -->
    <div id="revoke-modal" class="hidden fixed inset-0 z-[200] flex items-center justify-center">
        <div class="modal-backdrop absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeRevokeModal()"></div>
        <div class="modal-content relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="shield-alert" class="w-8 h-8 text-red-600"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-900" data-i18n="modal-revoke-title">ç¢ºèªæ’¤éŠ·åç‰‡</h3>
                <p class="text-sm text-slate-600 mt-2 leading-relaxed" data-i18n="modal-revoke-subtitle">æ’¤éŠ·å¾Œï¼Œæ‰€æœ‰åˆ†äº«é€£çµå°‡ç«‹å³å¤±æ•ˆ</p>
                <p class="text-xs text-amber-600 mt-2 font-medium" data-i18n="modal-revoke-warning">å¯åœ¨ 7 å¤©å…§è‡ªè¡Œæ¢å¾©</p>
                <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-xl">
                    <p class="text-xs text-blue-800">
                        <span class="font-bold">éœ€è¦ç«‹å³é‡æ–°è¨»å†Šï¼Ÿ</span><br>
                        è«‹è¯ç¹«ç®¡ç†å“¡å”åŠ©æ°¸ä¹…åˆªé™¤
                    </p>
                </div>
            </div>

            <div class="mb-6 space-y-2">
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider block" data-i18n="modal-revoke-reason">æ’¤éŠ·åŸå› ï¼ˆé¸å¡«ï¼‰</label>
                <select id="revoke-reason" class="w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-sm outline-none focus:border-moda">
                    <option value="" data-i18n="revoke-reason-none">ä¸æä¾›åŸå› </option>
                    <option value="lost" data-i18n="revoke-reason-lost">å¡ç‰‡éºå¤±</option>
                    <option value="suspected_leak" data-i18n="revoke-reason-leak">ç–‘ä¼¼è³‡è¨Šå¤–æ´©</option>
                    <option value="info_update" data-i18n="revoke-reason-update">è³‡è¨Šéœ€æ›´æ–°</option>
                    <option value="misdelivery">èª¤ç™¼</option>
                    <option value="other">å…¶ä»–</option>
                </select>
            </div>

            <div id="rate-limit-warning" class="hidden mb-4 p-3 bg-amber-50 border border-amber-200 rounded-xl">
                <p class="text-xs text-amber-800 font-medium"></p>
            </div>

            <div class="flex gap-3">
                <button onclick="closeRevokeModal()" class="flex-1 px-6 py-4 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200 transition-colors" data-i18n="button-cancel">
                    å–æ¶ˆ
                </button>
                <button id="confirm-revoke-btn" onclick="confirmRevokeCard()" class="flex-1 px-6 py-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors" data-i18n="button-confirm">
                    ç¢ºèªæ’¤éŠ·
                </button>
            </div>
        </div>
    </div>

    <!-- Rate Limit Error Banner -->
    <div id="rate-limit-banner" class="hidden fixed top-24 left-1/2 transform -translate-x-1/2 z-[250] max-w-md w-full mx-4">
        <div class="glass-panel p-4 rounded-2xl border-2 border-amber-500 shadow-lg">
            <div class="flex items-start gap-3">
                <i data-lucide="alert-triangle" class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"></i>
                <div class="flex-1">
                    <p id="rate-limit-message" class="text-sm font-bold text-slate-900"></p>
                    <p id="rate-limit-retry" class="text-xs text-slate-600 mt-1"></p>
                    <p class="text-xs text-blue-600 mt-2 font-medium">
                        éœ€è¦ç«‹å³åˆªé™¤ä¸¦é‡æ–°è¨»å†Šï¼Ÿè«‹è¯ç¹«ç®¡ç†å“¡å”åŠ©è™•ç†
                    </p>
                </div>
            </div>
        </div>
    </div>


    <script src="/js/user-portal-init.js"></script>
    <script>
        function createQRShortcut(uuid, cardName, cardType) {
            // Generate display name with fallback
            let displayName = cardName;
            if (!displayName) {
                const typeLabels = {
                    'personal': 'å€‹äººåç‰‡',
                    'event': 'æ´»å‹•åç‰‡',
                    'sensitive': 'æ•æ„Ÿåç‰‡'
                };
                displayName = typeLabels[cardType] || 'æ•¸ä½åç‰‡';
            }

            // Navigate to qr-quick.html (merged install + QR display)
            window.location.href = `/qr-quick.html?uuid=${uuid}&name=${encodeURIComponent(displayName)}&type=${encodeURIComponent(cardType || 'personal')}`;
        }
    </script>
    <!-- WebView Warning Modal -->
    <div id="webview-warning-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 max-w-md mx-4">
        <h3 class="text-lg font-bold mb-4" data-i18n="webview_warning_title">ä¸æ”¯æ´çš„ç€è¦½å™¨</h3>
        <p class="mb-4" data-i18n="webview_warning_message">
          æ­¤é é¢ä¸æ”¯æ´æ‡‰ç”¨ç¨‹å¼å…§å»ºç€è¦½å™¨ã€‚è«‹ä½¿ç”¨ç³»çµ±ç€è¦½å™¨ï¼ˆChromeã€Safariã€Firefoxï¼‰é–‹å•Ÿæ­¤é€£çµã€‚
        </p>
        <button onclick="copyCurrentURL()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 mb-2" data-i18n="copy_url">
          è¤‡è£½ç¶²å€
        </button>
        <button onclick="closeWebViewWarning()" class="w-full bg-gray-300 py-2 rounded hover:bg-gray-400" data-i18n="close">
          é—œé–‰
        </button>
      </div>
    </div>
</body>
</html>
